{
  "scenario_id": "template_faq_rag",
  "name": "–®–∞–±–ª–æ–Ω: FAQ –±–æ—Ç —Å RAG –ø–æ–∏—Å–∫–æ–º",
  "description": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π FAQ –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ LLM",
  "version": "1.0",
  "initial_context": {
    "bot_name": "FAQ –ü–æ–º–æ—â–Ω–∏–∫",
    "knowledge_base": "company_docs",
    "search_threshold": 0.7,
    "max_search_results": 3,
    "llm_model": "deepseek/deepseek-chat",
    "fallback_message": "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à—ë–ª –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.",
    "greeting": "–ü—Ä–∏–≤–µ—Ç! –Ø FAQ –ø–æ–º–æ—â–Ω–∏–∫. –ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –æ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏, –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –∏–ª–∏ —É—Å–ª—É–≥–∞—Ö."
  },
  "steps": [
    {
      "id": "start",
      "type": "start",
      "params": {},
      "next_step": "welcome"
    },
    {
      "id": "welcome",
      "type": "message",
      "params": {
        "text": "{greeting}\n\nüí° –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:\n‚Ä¢ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç?\n‚Ä¢ –ö–∞–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã —É –≤–∞—Å –µ—Å—Ç—å?\n‚Ä¢ –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?\n‚Ä¢ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞?"
      },
      "next_step": "get_question"
    },
    {
      "id": "get_question",
      "type": "input",
      "params": {
        "prompt": "–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å:",
        "input_type": "text",
        "output_var": "user_question"
      },
      "next_step": "check_exit_intent"
    },
    {
      "id": "check_exit_intent",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('user_question', '').lower().strip() in ['–≤—ã—Ö–æ–¥', 'exit', '–ø–æ–∫–∞', '—Å–ø–∞—Å–∏–±–æ', '—Ö–≤–∞—Ç–∏—Ç', '—Å—Ç–æ–ø']",
            "next_step": "farewell"
          }
        ],
        "default_next_step": "search_knowledge_base"
      }
    },
    {
      "id": "search_knowledge_base",
      "type": "rag_search",
      "params": {
        "query": "{user_question}",
        "knowledge_base": "{knowledge_base}",
        "max_results": "{max_search_results}",
        "threshold": "{search_threshold}",
        "output_var": "search_results"
      },
      "next_step": "evaluate_search_results"
    },
    {
      "id": "evaluate_search_results",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('search_results') and len(context.get('search_results', [])) > 0",
            "next_step": "generate_answer"
          }
        ],
        "default_next_step": "no_results_found"
      }
    },
    {
      "id": "generate_answer",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å: \"{user_question}\"\n\n–Ø –Ω–∞—à—ë–ª —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π:\n\n{search_results}\n\n–ò—Å–ø–æ–ª—å–∑—É—è —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –¥–∞–π —Ç–æ—á–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–∞—è, —É–∫–∞–∂–∏ —ç—Ç–æ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.\n\n–û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.",
        "model": "{llm_model}",
        "max_tokens": 400,
        "temperature": 0.3,
        "output_var": "generated_answer"
      },
      "next_step": "show_answer"
    },
    {
      "id": "show_answer",
      "type": "message",
      "params": {
        "text": "ü§ñ **{bot_name}:**\n\n{generated_answer}\n\n---\nüìö *–û—Ç–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø–æ–∏—Å–∫–µ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π*"
      },
      "next_step": "ask_satisfaction"
    },
    {
      "id": "no_results_found",
      "type": "llm_request",
      "params": {
        "prompt": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å: \"{user_question}\"\n\n–Ø –Ω–µ –Ω–∞—à—ë–ª —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –≤–µ–∂–ª–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏ –ø—Ä–µ–¥–ª–æ–∂–∏:\n1. –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å\n2. –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π\n3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FAQ –Ω–∞ —Å–∞–π—Ç–µ\n\n–ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –∏–∑–≤–∏–Ω–∏—Å—å –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞.",
        "model": "{llm_model}",
        "max_tokens": 200,
        "temperature": 0.3,
        "output_var": "no_results_message"
      },
      "next_step": "show_no_results"
    },
    {
      "id": "show_no_results",
      "type": "message",
      "params": {
        "text": "ü§ñ **{bot_name}:**\n\n{no_results_message}\n\nüìû **–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**\n‚Ä¢ Email: support@company.com\n‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: +7 (800) 123-45-67\n‚Ä¢ –ß–∞—Ç –Ω–∞ —Å–∞–π—Ç–µ: company.com"
      },
      "next_step": "ask_new_question"
    },
    {
      "id": "ask_satisfaction",
      "type": "input",
      "params": {
        "prompt": "–ü–æ–º–æ–≥ –ª–∏ –º–æ–π –æ—Ç–≤–µ—Ç? (–¥–∞/–Ω–µ—Ç/—á–∞—Å—Ç–∏—á–Ω–æ)",
        "input_type": "text",
        "output_var": "satisfaction"
      },
      "next_step": "process_satisfaction"
    },
    {
      "id": "process_satisfaction",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('satisfaction', '').lower().strip() in ['–¥–∞', 'yes', '–ø–æ–º–æ–≥', '—Å–ø–∞—Å–∏–±–æ', '–æ—Ç–ª–∏—á–Ω–æ']",
            "next_step": "satisfied_response"
          },
          {
            "condition": "context.get('satisfaction', '').lower().strip() in ['—á–∞—Å—Ç–∏—á–Ω–æ', '–Ω–µ –æ—á–µ–Ω—å', '—Ç–∞–∫ —Å–µ–±–µ']",
            "next_step": "partially_satisfied"
          }
        ],
        "default_next_step": "not_satisfied"
      }
    },
    {
      "id": "satisfied_response",
      "type": "message",
      "params": {
        "text": "–û—Ç–ª–∏—á–Ω–æ! –†–∞–¥, —á—Ç–æ —Å–º–æ–≥ –ø–æ–º–æ—á—å! üòä"
      },
      "next_step": "save_feedback"
    },
    {
      "id": "partially_satisfied",
      "type": "message",
      "params": {
        "text": "–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –æ—Ç–≤–µ—Ç –º–æ–≥ –±—ã—Ç—å –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–º. –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏."
      },
      "next_step": "save_feedback"
    },
    {
      "id": "not_satisfied",
      "type": "message",
      "params": {
        "text": "–ò–∑–≤–∏–Ω–∏—Ç–µ, —á—Ç–æ –Ω–µ —Å–º–æ–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–æ—á—å. –í–∞—à –≤–æ–ø—Ä–æ—Å –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω –≤ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞—à–µ–π –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π."
      },
      "next_step": "save_feedback"
    },
    {
      "id": "save_feedback",
      "type": "mongo_insert_one",
      "params": {
        "collection": "faq_interactions",
        "document": {
          "user_question": "{user_question}",
          "search_results": "{search_results}",
          "generated_answer": "{generated_answer}",
          "satisfaction": "{satisfaction}",
          "knowledge_base": "{knowledge_base}",
          "timestamp": "{current_timestamp}",
          "session_id": "{session_id}"
        },
        "output_var": "feedback_saved"
      },
      "next_step": "ask_new_question"
    },
    {
      "id": "ask_new_question",
      "type": "input",
      "params": {
        "prompt": "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã? (–¥–∞/–Ω–µ—Ç)",
        "input_type": "text",
        "output_var": "continue_choice"
      },
      "next_step": "check_continue"
    },
    {
      "id": "check_continue",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('continue_choice', '').lower().strip() in ['–¥–∞', 'yes', '–µ—Å—Ç—å', '–∫–æ–Ω–µ—á–Ω–æ', '–µ—â—ë']",
            "next_step": "get_question"
          }
        ],
        "default_next_step": "farewell"
      }
    },
    {
      "id": "farewell",
      "type": "message",
      "params": {
        "text": "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —è –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.\n\nüìû **–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ:**\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7\n‚Ä¢ FAQ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ\n‚Ä¢ –ú–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫–æ –º–Ω–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\n\n–£–¥–∞—á–Ω–æ–≥–æ –¥–Ω—è! üëã"
      },
      "next_step": "log_session_end"
    },
    {
      "id": "log_session_end",
      "type": "log",
      "params": {
        "message": "FAQ session ended. Total questions answered: {questions_count}",
        "level": "INFO"
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end",
      "params": {}
    }
  ]
} 