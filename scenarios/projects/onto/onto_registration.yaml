scenario_id: onto_registration
description: "–°–µ—Ä–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ AmoCRM"
version: "1.0"

steps:
  - id: start
    type: start
    next_step: ask_name

  - id: ask_name
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üëã –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?
        
        –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è, –∫–∞–∫ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã, —á—Ç–æ–±—ã —è –∫ –≤–∞–º –æ–±—Ä–∞—â–∞–ª—Å—è.
      parse_mode: HTML
    next_step: wait_name

  - id: wait_name
    type: input
    params:
      variable: user_name
      validation: "required"
    next_step: save_name

  - id: save_name
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–ò–º—è: {user_name}"
      note_type: "common"
    next_step: ask_age

  - id: ask_age
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéÇ –°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç?
        
        –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç —Ü–∏—Ñ—Ä–∞–º–∏.
      parse_mode: HTML
    next_step: wait_age

  - id: wait_age
    type: input
    params:
      variable: user_age
      validation: "number"
    next_step: save_age

  - id: save_age
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–í–æ–∑—Ä–∞—Å—Ç: {user_age} –ª–µ—Ç"
      note_type: "common"
    next_step: ask_profession

  - id: ask_profession
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üíº –ß–µ–º –≤—ã –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ?
        
        –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –æ—Å–Ω–æ–≤–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ä–∞–±–æ—Ç–µ –∏–ª–∏ –±–∏–∑–Ω–µ—Å–µ.
      parse_mode: HTML
    next_step: wait_profession

  - id: wait_profession
    type: input
    params:
      variable: user_profession
      validation: "required"
    next_step: save_profession

  - id: save_profession
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: {user_profession}"
      note_type: "common"
    next_step: ask_goals

  - id: ask_goals
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéØ –ö–∞–∫–∏–µ —É –≤–∞—Å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏ –≤ –∂–∏–∑–Ω–∏?
        
        –û–ø–∏—à–∏—Ç–µ 2-3 –≥–ª–∞–≤–Ω—ã–µ —Ü–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ—Å—Ç–∏—á—å.
      parse_mode: HTML
    next_step: wait_goals

  - id: wait_goals
    type: input
    params:
      variable: user_goals
      validation: "required"
    next_step: save_goals

  - id: save_goals
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–¶–µ–ª–∏: {user_goals}"
      note_type: "common"
    next_step: ask_challenges

  - id: ask_challenges
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üöß –° –∫–∞–∫–∏–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ –≤—ã —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç–µ—Å—å?
        
        –û–ø–∏—à–∏—Ç–µ –≥–ª–∞–≤–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π.
      parse_mode: HTML
    next_step: wait_challenges

  - id: wait_challenges
    type: input
    params:
      variable: user_challenges
      validation: "required"
    next_step: save_challenges

  - id: save_challenges
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–í—ã–∑–æ–≤—ã: {user_challenges}"
      note_type: "common"
    next_step: ask_motivation

  - id: ask_motivation
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üí™ –ß—Ç–æ –≤–∞—Å –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø–µ—Ä–µ–¥?
        
        –û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è.
      parse_mode: HTML
    next_step: wait_motivation

  - id: wait_motivation
    type: input
    params:
      variable: user_motivation
      validation: "required"
    next_step: save_motivation

  - id: save_motivation
    type: amocrm_add_note
    params:
      entity_type: "contact"
      entity_id: "{amocrm_contact_id}"
      text: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è: {user_motivation}"
      note_type: "common"
    next_step: complete_registration

  - id: complete_registration
    type: mongo_update_document
    params:
      collection: users
      filter:
        telegram_user_id: "{user_id}"
      document:
        name: "{user_name}"
        age: "{user_age}"
        profession: "{user_profession}"
        goals: "{user_goals}"
        challenges: "{user_challenges}"
        motivation: "{user_motivation}"
        registration_completed: true
        registration_completed_at: "{current_timestamp}"
    next_step: thank_user

  - id: thank_user
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ‚úÖ –û—Ç–ª–∏—á–Ω–æ, {user_name}! –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.
        
        üìä –¢–µ–ø–µ—Ä—å –Ω–∞—à –ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –∏ —Å–æ–∑–¥–∞—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å.
        
        ‚è±Ô∏è –≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...
      parse_mode: HTML
    next_step: start_ai_analysis

  - id: start_ai_analysis
    type: switch_scenario
    params:
      scenario_id: onto_ai_analysis
      reason: "Registration completed, starting AI analysis"

  - id: end
    type: end 