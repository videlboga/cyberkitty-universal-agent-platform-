scenario_id: ai_mentor_flow_v2
description: "AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ - –ø–æ–º–æ—â—å —Å –æ–±—É—á–µ–Ω–∏–µ–º –∏ –∫—É—Ä—Å–∞–º–∏ v2.0"
version: "2.0"

initial_context:
  module_name: "AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫"
  mentor_mode: "general"

steps:
  - id: start
    type: start
    next_step: welcome_mentor

  - id: welcome_mentor
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üë®‚Äçüè´ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –∫ AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫—É!**

        –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å:
        ‚Ä¢ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
        ‚Ä¢ –†–∞–∑–±–æ—Ä–æ–º —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
        ‚Ä¢ –û—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫—É—Ä—Å–∞–º
        ‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é

        ü§î **–û —á–µ–º —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?**
      parse_mode: HTML
    next_step: show_topics

  - id: show_topics
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: |
        üìö **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã:**

        –í—ã–±–µ—Ä–∏ —Ç–µ–º—É –∏–ª–∏ –∑–∞–¥–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å:
      buttons:
        - - text: "ü§ñ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"
            callback_data: "topic_ai"
        - - text: "üíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ"
            callback_data: "topic_programming"
        - - text: "üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö"
            callback_data: "topic_data"
        - - text: "üöÄ –°—Ç–∞—Ä—Ç–∞–ø—ã –∏ –±–∏–∑–Ω–µ—Å"
            callback_data: "topic_business"
        - - text: "üé® –î–∏–∑–∞–π–Ω –∏ UX"
            callback_data: "topic_design"
        - - text: "üìà –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"
            callback_data: "topic_marketing"
        - - text: "‚ùì –ó–∞–¥–∞—Ç—å —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å"
            callback_data: "custom_question"
    next_step: wait_topic

  - id: wait_topic
    type: input
    params:
      variable: selected_topic
      validation: "required"
    next_step: process_topic

  - id: process_topic
    type: branch
    params:
      conditions:
        - condition: "context.get('selected_topic') == 'custom_question'"
          next_step: ask_custom_question
      default_next_step: ask_specific_question

  - id: ask_specific_question
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üìù **–û—Ç–ª–∏—á–Ω–æ! –¢–µ–º–∞: {selected_topic}**

        –¢–µ–ø–µ—Ä—å –∑–∞–¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ.

        –ù–∞–ø—Ä–∏–º–µ—Ä:
        ‚Ä¢ "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏?"
        ‚Ä¢ "–ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤–∏—á–∫—É?"
        ‚Ä¢ "–ö–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ?"

        –ß–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ –≤–æ–ø—Ä–æ—Å, —Ç–µ–º –ª—É—á—à–µ —è —Å–º–æ–≥—É –ø–æ–º–æ—á—å! üéØ
      parse_mode: HTML
    next_step: wait_specific_question

  - id: wait_specific_question
    type: input
    params:
      variable: user_question
      validation: "required"
    next_step: generate_topic_answer

  - id: ask_custom_question
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ‚ùì **–ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø–æ –æ–±—É—á–µ–Ω–∏—é:**

        –Ø –ø–æ–º–æ–≥—É —Å:
        ‚Ä¢ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
        ‚Ä¢ –†–∞–∑–±–æ—Ä–æ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
        ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –∏–∑—É—á–µ–Ω–∏—é
        ‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ–±—É—á–µ–Ω–∏—è

        –ü–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –ø–æ–¥—Ä–æ–±–Ω–æ üëá
      parse_mode: HTML
    next_step: wait_custom_question

  - id: wait_custom_question
    type: input
    params:
      variable: user_question
      validation: "required"
    next_step: generate_custom_answer

  - id: generate_topic_answer
    type: llm_query
    params:
      model: "gpt-4"
      system_prompt: |
        –¢—ã - –æ–ø—ã—Ç–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–Ω—è—Ç–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ.
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:
        1. –ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
        2. –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
        3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
        4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è
        5. –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
        
        –°—Ç–∏–ª—å:
        - –ü–æ–Ω—è—Ç–Ω—ã–π –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
        - –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏
        - –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π
        - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
      user_prompt: |
        –¢–µ–º–∞: {selected_topic}
        –í–æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞: {user_question}
        
        –î–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞.
      output_var: mentor_answer
    next_step: present_answer

  - id: generate_custom_answer
    type: llm_query
    params:
      model: "gpt-4"
      system_prompt: |
        –¢—ã - –º—É–¥—Ä—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ —Å –±–æ–ª—å—à–∏–º –æ–ø—ã—Ç–æ–º –æ–±—É—á–µ–Ω–∏—è. –ü–æ–º–æ–≥–∞–π —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö.
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:
        1. –ê–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞
        2. –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
        4. –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
        5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
        
        –ü—Ä–∏–Ω—Ü–∏–ø—ã:
        - –ê–¥–∞–ø—Ç–∏—Ä—É–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å –≤–æ–ø—Ä–æ—Å–∞
        - –ò—Å–ø–æ–ª—å–∑—É–π –∞–Ω–∞–ª–æ–≥–∏–∏ –∏ –º–µ—Ç–∞—Ñ–æ—Ä—ã
        - –î–∞–≤–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
        - –ú–æ—Ç–∏–≤–∏—Ä—É–π –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –∏–∑—É—á–µ–Ω–∏—é
      user_prompt: |
        –í–æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞: {user_question}
        
        –î–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞.
      output_var: mentor_answer
    next_step: present_answer

  - id: present_answer
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üë®‚Äçüè´ **–û—Ç–≤–µ—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞:**

        {mentor_answer}

        üìö **–ë—ã–ª–æ –ø–æ–ª–µ–∑–Ω–æ?**
      parse_mode: HTML
    next_step: ask_follow_up

  - id: ask_follow_up
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: "–ß—Ç–æ –¥–∞–ª—å—à–µ?"
      buttons:
        - - text: "ü§î –£—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å"
            callback_data: "follow_up"
        - - text: "üìù –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å"
            callback_data: "new_question"
        - - text: "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç"
            callback_data: "save_answer"
        - - text: "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
            callback_data: "main_menu"
    next_step: wait_follow_up

  - id: wait_follow_up
    type: input
    params:
      variable: user_action
      validation: "required"
    next_step: process_follow_up

  - id: process_follow_up
    type: branch
    params:
      conditions:
        - condition: "context.get('user_action') == 'follow_up'"
          next_step: ask_follow_up_question
        - condition: "context.get('user_action') == 'new_question'"
          next_step: show_topics
        - condition: "context.get('user_action') == 'save_answer'"
          next_step: save_answer
        - condition: "context.get('user_action') == 'main_menu'"
          next_scenario: likeprovodnik_main_router_v2
      default_next_step: end

  - id: ask_follow_up_question
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ü§î **–ó–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å:**

        –ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ö–æ—á–µ—à—å —É—Ç–æ—á–Ω–∏—Ç—å –∏–ª–∏ —É–≥–ª—É–±–∏—Ç—å?
      parse_mode: HTML
    next_step: wait_follow_up_question

  - id: wait_follow_up_question
    type: input
    params:
      variable: follow_up_question
      validation: "required"
    next_step: generate_follow_up_answer

  - id: generate_follow_up_answer
    type: llm_query
    params:
      model: "gpt-4"
      system_prompt: |
        –¢—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –±–µ—Å–µ–¥—É –∫–∞–∫ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –£ —Ç–µ–±—è –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞.
        
        –î–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –æ—Ç–≤–µ—Ç:
        - –û–ø–∏—Ä–∞–π—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
        - –£–≥–ª—É–±–∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã
        - –î–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
        - –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º
      user_prompt: |
        –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç: {mentor_answer}
        –£—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å: {follow_up_question}
        
        –î–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å.
      output_var: follow_up_answer
    next_step: present_follow_up

  - id: present_follow_up
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üí° **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**

        {follow_up_answer}
      parse_mode: HTML
    next_step: ask_follow_up

  - id: save_answer
    type: mongo_insert_document
    params:
      collection: user_mentor_sessions
      document:
        user_id: "{user_id}"
        question: "{user_question}"
        answer: "{mentor_answer}"
        topic: "{selected_topic}"
        follow_up_question: "{follow_up_question}"
        follow_up_answer: "{follow_up_answer}"
        created_at: "{current_timestamp}"
    next_step: confirm_save

  - id: confirm_save
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üíæ **–°–µ—Å—Å–∏—è —Å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!**

        –¢—ã –º–æ–∂–µ—à—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –º–∞—Ç–µ—Ä–∏–∞–ª—É –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.

        –ï—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã? üòä
      parse_mode: HTML
    next_step: show_topics

  - id: end
    type: end 