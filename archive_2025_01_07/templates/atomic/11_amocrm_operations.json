{
  "scenario_id": "atomic_amocrm_operations",
  "name": "–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ AmoCRM",
  "description": "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π SimpleAmoCRMPlugin",
  "initial_context": {
    "user_telegram_id": "123456789",
    "user_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "user_phone": "+79001234567",
    "user_email": "ivan@example.com"
  },
  "steps": [
    {
      "id": "start_step",
      "type": "log_message",
      "params": {
        "message": "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é AmoCRM –æ–ø–µ—Ä–∞—Ü–∏–π",
        "level": "INFO"
      },
      "next_step": "find_existing_contact"
    },
    {
      "id": "find_existing_contact",
      "type": "amocrm_find_contact",
      "params": {
        "telegram_id": "{user_telegram_id}",
        "output_var": "existing_contact"
      },
      "next_step": "check_contact_exists"
    },
    {
      "id": "check_contact_exists",
      "type": "conditional",
      "params": {
        "condition": "{existing_contact.found}",
        "true_step": "update_existing_contact",
        "false_step": "create_new_contact"
      }
    },
    {
      "id": "create_new_contact",
      "type": "amocrm_create_contact",
      "params": {
        "name": "{user_name}",
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "custom_fields": {
          "telegram_id": "{user_telegram_id}",
          "phone": "{user_phone}",
          "email": "{user_email}",
          "source": "Telegram"
        },
        "output_var": "created_contact"
      },
      "next_step": "log_contact_created"
    },
    {
      "id": "update_existing_contact",
      "type": "amocrm_update_contact",
      "params": {
        "contact_id": "{existing_contact.contact.id}",
        "update_data": {
          "phone": "{user_phone}",
          "email": "{user_email}",
          "notes": "–û–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞"
        },
        "output_var": "updated_contact"
      },
      "next_step": "log_contact_updated"
    },
    {
      "id": "log_contact_created",
      "type": "log_message",
      "params": {
        "message": "‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç: {created_contact.contact_id}",
        "level": "INFO"
      },
      "next_step": "create_lead_for_contact"
    },
    {
      "id": "log_contact_updated",
      "type": "log_message",
      "params": {
        "message": "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–∞–∫—Ç: {existing_contact.contact.id}",
        "level": "INFO"
      },
      "next_step": "create_lead_for_contact"
    },
    {
      "id": "create_lead_for_contact",
      "type": "amocrm_create_lead",
      "params": {
        "name": "–°–¥–µ–ª–∫–∞ –æ—Ç {user_name}",
        "price": 50000,
        "contact_id": "{created_contact.contact_id || existing_contact.contact.id}",
        "custom_fields": {
          "source": "Telegram",
          "budget": 50000
        },
        "output_var": "created_lead"
      },
      "next_step": "add_note_to_lead"
    },
    {
      "id": "add_note_to_lead",
      "type": "amocrm_add_note",
      "params": {
        "entity_type": "leads",
        "entity_id": "{created_lead.lead_id}",
        "note_text": "–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_name} (ID: {user_telegram_id})",
        "note_type": "common",
        "output_var": "note_result"
      },
      "next_step": "search_similar_contacts"
    },
    {
      "id": "search_similar_contacts",
      "type": "amocrm_search",
      "params": {
        "query": "–ò–≤–∞–Ω",
        "entity_type": "contacts",
        "limit": 10,
        "output_var": "similar_contacts"
      },
      "next_step": "log_search_results"
    },
    {
      "id": "log_search_results",
      "type": "log_message",
      "params": {
        "message": "üîç –ù–∞–π–¥–µ–Ω–æ –ø–æ—Ö–æ–∂–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: {similar_contacts.count}",
        "level": "INFO"
      },
      "next_step": "final_summary"
    },
    {
      "id": "final_summary",
      "type": "log_message",
      "params": {
        "message": "üéØ AmoCRM –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! –ö–æ–Ω—Ç–∞–∫—Ç: {created_contact.contact_id || existing_contact.contact.id}, –°–¥–µ–ª–∫–∞: {created_lead.lead_id}",
        "level": "INFO"
      }
    }
  ],
  "examples": {
    "find_contact_by_telegram": {
      "description": "–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ Telegram ID",
      "step": {
        "type": "amocrm_find_contact",
        "params": {
          "telegram_id": "123456789",
          "output_var": "found_contact"
        }
      }
    },
    "find_contact_by_phone": {
      "description": "–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É",
      "step": {
        "type": "amocrm_find_contact",
        "params": {
          "phone": "+79001234567",
          "output_var": "found_contact"
        }
      }
    },
    "create_contact_with_custom_fields": {
      "description": "–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–æ–ª—è–º–∏",
      "step": {
        "type": "amocrm_create_contact",
        "params": {
          "name": "–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
          "first_name": "–ò–≤–∞–Ω",
          "last_name": "–ü–µ—Ç—Ä–æ–≤",
          "custom_fields": {
            "telegram_id": "123456789",
            "phone": "+79001234567",
            "email": "ivan@example.com",
            "source": "Telegram",
            "budget": 100000,
            "interests": ["–ü—Ä–æ–¥–∞–∂–∏", "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"]
          },
          "output_var": "new_contact"
        }
      }
    },
    "create_lead_with_contact": {
      "description": "–°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É",
      "step": {
        "type": "amocrm_create_lead",
        "params": {
          "name": "–í–∞–∂–Ω–∞—è —Å–¥–µ–ª–∫–∞",
          "price": 150000,
          "contact_id": 12345,
          "pipeline_id": 1,
          "status_id": 142,
          "custom_fields": {
            "source": "Telegram",
            "budget": 150000
          },
          "output_var": "new_lead"
        }
      }
    },
    "add_note_to_contact": {
      "description": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –∫ –∫–æ–Ω—Ç–∞–∫—Ç—É",
      "step": {
        "type": "amocrm_add_note",
        "params": {
          "entity_type": "contacts",
          "entity_id": 12345,
          "note_text": "–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—è–≤–∏–ª –∏–Ω—Ç–µ—Ä–µ—Å –∫ –Ω–∞—à–∏–º —É—Å–ª—É–≥–∞–º",
          "note_type": "common",
          "output_var": "note_added"
        }
      }
    },
    "search_leads": {
      "description": "–ü–æ–∏—Å–∫ —Å–¥–µ–ª–æ–∫",
      "step": {
        "type": "amocrm_search",
        "params": {
          "query": "–≤–∞–∂–Ω–∞—è",
          "entity_type": "leads",
          "limit": 20,
          "output_var": "found_leads"
        }
      }
    },
    "update_contact_info": {
      "description": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ",
      "step": {
        "type": "amocrm_update_contact",
        "params": {
          "contact_id": 12345,
          "update_data": {
            "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á –°–∏–¥–æ—Ä–æ–≤",
            "phone": "+79009876543",
            "email": "new_email@example.com",
            "notes": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
          },
          "output_var": "updated_contact"
        }
      }
    }
  },
  "configuration": {
    "required_env_vars": [
      "AMO_BASE_URL",
      "AMO_ACCESS_TOKEN"
    ],
    "optional_files": [
      "app/config/amo_fields.json"
    ],
    "notes": [
      "–î–ª—è —Ä–∞–±–æ—Ç—ã –ø–ª–∞–≥–∏–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è",
      "–§–∞–π–ª amo_fields.json —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Ä—Ç—É –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π AmoCRM",
      "ID –ø–æ–ª–µ–π –∏ enum –∑–Ω–∞—á–µ–Ω–∏–π –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É AmoCRM",
      "–ü–ª–∞–≥–∏–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π AmoCRM"
    ]
  }
} 