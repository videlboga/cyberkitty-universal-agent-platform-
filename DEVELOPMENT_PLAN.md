# Universal Agent Platform — актуальный статус (май 2025)

**Текущий этап:**
- Реализованы: healthcheck endpoint, CRUD для коллекций (MongoDB), логирование (loguru, JSON), контейнеризация (Docker, docker-compose), автогенерация Swagger/OpenAPI, базовые unit/integration тесты, документация с curl-примерами, примеры сценариев, интеграция с Telegram (healthcheck и отправка сообщений работают).
- В процессе: e2e-тесты, CI/CD, pre-commit, визуальный редактор сценариев, доработка документации.
- Не реализовано: RBAC, OAuth2/JWT, ограничения по ролям, полноценная безопасность, e2e-тесты, UI для flow-диаграмм.

---

## Чек-лист: Flow-сценарии и коллекции
- [ ] Удалить BPMN из кода, UI, документации (требует проверки)
- [~] Перевести сценарии на flow-диаграммы (nodes/edges) — частично реализовано, есть docs/scenario_format.md и примеры, но UI-редактор не готов
- [x] Реализовать динамические коллекции и универсальные CRUD-эндпоинты — реализовано (app/api/collection.py)
- [ ] Привязка коллекций к агентам (config, UI) — требует доработки
- [~] Обновить документацию и тесты — частично реализовано (README.md, docs/, unit/integration тесты)
- [ ] Проверить безопасность (RBAC, валидация) — не реализовано

## Задачи по API коллекций
- [x] Реализовать API для создания новых коллекций (POST /db/collections) — реализовано
- [ ] Реализовать API для описания схемы коллекции (опционально) — не реализовано
- [x] Реализовать универсальные CRUD-эндпоинты для работы с данными в коллекциях — реализовано
- [ ] В конфиге агента добавить поле collections/data_sources для привязки к коллекциям — не реализовано
- [ ] UI для выбора/создания коллекции при настройке агента — не реализовано
- [~] Документировать процесс создания коллекций и их привязки к агентам — частично реализовано (README.md)
- [ ] Ограничить доступ к коллекциям по ролям (RBAC) — не реализовано
- [ ] Валидация данных при записи (если задана схема) — не реализовано

## Чек-лист: Новый микросервис
- [x] Создан репозиторий/папка сервиса
- [x] Описан requirements.txt/pyproject.toml с зависимостями
- [x] Настроен Dockerfile и docker-compose.yml
- [x] Реализован healthcheck endpoint (app/main.py, /health)
- [x] Описан OpenAPI/Swagger для всех эндпоинтов (FastAPI, /docs)
- [x] Настроено логирование в logs/<service>.log (loguru, JSON)
- [ ] Подключён централизованный сбор логов (ELK/Graylog) — не реализовано
- [~] Покрытие тестами >80% (unit/integration) — частично реализовано, e2e-тесты отсутствуют
- [~] Настроен CI/CD pipeline (lint, test, build, deploy) — частично, требуется настройка pre-commit и GitHub Actions
- [~] Документация в docs/ и README.md — частично, есть curl-примеры, структура, переменные окружения

## Чек-лист: Новая интеграция/плагин
- [x] Описан интерфейс плагина (PluginBase)
- [x] Реализована регистрация и инициализация (см. app/plugins/)
- [~] Реализована обработка ошибок и fallback — частично (есть логирование ошибок, но не везде)
- [~] Добавлены примеры использования — частично (README.md, docs/examples)
- [~] Покрытие тестами >80% — частично (есть unit/integration тесты для плагинов)
- [~] Документация по настройке и использованию — частично (README.md)

## Чек-лист: Новый сценарий/агент
- [x] Описан сценарий в формате JSON/YAML (docs/examples/branching_scenario.json)
- [~] Протестированы все ветвления и переходы — частично (unit/integration тесты)
- [ ] Настроены промты и локализации — не реализовано
- [~] Проверена интеграция с LLM/RAG/CRM — частично (есть mock-интеграции, тесты)
- [ ] Добавлен шаблон в библиотеку сценариев — требует доработки
- [~] Описан use case и инструкция для админки — частично (docs/)

## Чек-лист: Тесты
- [x] Unit-тесты для всех ключевых функций (tests/)
- [x] Интеграционные тесты для API и интеграций (tests/)
- [ ] E2E-тесты для пользовательских сценариев — не реализовано
- [x] Логи тестов в logs/unit_tests.log, logs/integration_tests.log
- [~] Покрытие тестами >80% — требует проверки

## Чек-лист: Интеграция с Telegram
- [x] Реализован плагин Telegram (app/plugins/telegram_plugin.py) — реализовано, ошибки с filters.STICKER и healthcheck устранены
- [x] Реализован endpoint для отправки сообщений (/integration/telegram/send)
- [x] Реализован healthcheck endpoint (/integration/telegram/health) — работает корректно
- [ ] Покрытие тестами — не реализовано
- [~] Документация по настройке и curl-примеры — обновлено (README.md)

## Чек-лист: Безопасность
- [ ] Реализован RBAC, аутентификация (OAuth2/JWT), rate limiting — не реализовано
- [ ] Все секреты только в .env (не коммитить в git) — требует проверки
- [ ] Логи подозрительных активностей — не реализовано

## Чек-лист: Документация
- [x] Документация хранится в docs/
- [x] Автогенерация OpenAPI/Swagger для всех API (FastAPI)
- [x] Примеры сценариев, гайды — docs/examples, docs/scenario_format.md
- [x] README.md содержит curl-примеры для всех API

## Чек-лист: Интерактивный Telegram-бот и визуальный редактор сценариев
- [ ] Визуальный редактор Telegram-интерфейса (frontend)
    - [ ] Возможность создавать экраны (nodes) и соединять их переходами (edges)
    - [ ] Добавление и настройка кнопок внутри экрана (текст, callback, тип)
    - [ ] Drag&drop для экранов и кнопок
    - [ ] Preview Telegram-экрана (имитация мобильного UI)
    - [ ] Экспорт/импорт flow в JSON/YAML для backend
- [ ] Поддержка интерактивных меню и кнопок в Telegram (backend)
    - [ ] ReplyKeyboardMarkup/InlineKeyboardMarkup, обработка callback'ов
    - [ ] Генерация Telegram-меню и переходов на основе flow-структуры
- [ ] Менеджер агентов и динамические переходы
    - [ ] State machine с поддержкой подагентов и возврата в меню
    - [ ] Сценарии для каждого подагента (коуч, лайфхакер, ментор, дайджест, эксперт)
    - [ ] Переключение между агентами через кнопки и команды
- [ ] Автоматические триггеры (по расписанию)
    - [ ] Celery/scheduler, запуск сценариев по расписанию (вечер, утро, неделя)
    - [ ] Привязка отправки сообщений к нужным сценариям/агентам
    - [ ] Отображение триггеров в редакторе сценариев (frontend)
- [ ] Реальные интеграции (RAG, LLM, новости)
    - [ ] Подключение внешних сервисов, настройка ключей
    - [ ] Настройка интеграций в шагах сценария (frontend)
- [ ] UX: input/валидация/AI feedback
    - [ ] Узлы "Input" с настройкой типа и валидации (frontend)
    - [ ] Ветвления по результату валидации (success/error)
    - [ ] Узел "AI Feedback" для генерации пояснений через LLM
    - [ ] Визуализация возвратной петли (loop)
    - [ ] Preview Telegram-экрана с интерактивным вводом
    - [ ] Поддержка валидации инпутов и AI-ответа на backend
- [ ] Улучшение шаблонов, локализация, e2e-тесты
    - [ ] Редактор шаблонов, предпросмотр сообщений (frontend)
    - [ ] Локализация сообщений, e2e-тесты для всего userflow

---

(Остальные шаблоны и детали оставляю без изменений)