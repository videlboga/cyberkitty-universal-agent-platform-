# Документация по использованию RAG API в n8n

## Общая информация

Данный API предназначен для поиска информации в курсах с использованием семантической векторной базы данных (RAG - Retrieval Augmented Generation). API оптимизирован для работы с n8n и поддерживает корректную обработку кириллицы.

## Endpoint для запросов

```
http://rag.cyberkitty.tech/api/search
```

## Формат запроса

API поддерживает несколько форматов запросов, но для n8n рекомендуется использовать следующий формат:

```json
{
  "data": "текст запроса,количество_результатов"
}
```

Где:
- `текст запроса` - строка поискового запроса на русском языке
- `количество_результатов` - число от 1 до 20, определяющее максимальное количество возвращаемых результатов
- Формат `"текст запроса,количество_результатов"` - это одна строка с запятой между текстом и числом (без пробелов)

### Примеры запросов

```json
{"data": "нейросети,5"}
{"data": "маркетинг,3"}
{"data": "инвестиции в бизнес,10"}
```

## Формат ответа

API возвращает JSON с двумя полями:

```json
{
  "success": true,
  "results": "Текст с результатами поиска в формате Markdown"
}
```

Поле `results` содержит результаты поиска в формате Markdown со следующей структурой:

```
### Найдено N результатов:

#### Результат #1 (релевантность: 0.XXXX)
**Курс:** Название курса

**Источник:** Путь к исходному файлу

Текст найденного фрагмента...

---

#### Результат #2 (релевантность: 0.XXXX)
...
```

## Интеграция с n8n

Для работы с API в n8n необходимо:

1. Использовать узел "HTTP Request" с методом `POST`
2. Указать URL `http://rag.cyberkitty.tech/api/search`
3. Настроить JSON-тело запроса в соответствии с форматом `{"data": "запрос,число"}`
4. Обработать ответ, используя поле `results` для получения текста результатов поиска

### Пример настройки в n8n

```
[HTTP Request]
  Method: POST
  URL: http://rag.cyberkitty.tech/api/search 
  Headers: Content-Type: application/json
  Request Body: 
  {
    "data": "{{$node['Input'].data.searchQuery}},5"
  }

[Text]
  Входящие данные: результаты поиска - {{$node['HTTP Request'].json.results}}
```

## Примечания

- API корректно обрабатывает кириллицу в запросах и ответах
- Максимальное количество результатов ограничено 20
- Каждый результат содержит не более 1000 символов текста (обрезается и заканчивается "...")
- API автоматически обогащает результаты поиска ссылками на уроки, если они доступны
- При получении ошибки формат ответа будет иметь вид `{"success": false, "error": "Текст ошибки"}` 