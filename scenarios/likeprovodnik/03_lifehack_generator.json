{
  "scenario_id": "lifehack_generator_flow",
  "name": "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ª–∞–π—Ñ—Ö–∞–∫–æ–≤",
  "description": "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–∞–π—Ñ—Ö–∞–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "version": "1.0",
  
  "steps": [
    {
      "id": "start",
      "type": "start",
      "next_step": "load_user_context"
    },
    {
      "id": "load_user_context",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_mongo_find_data",
        "context_updates": {
          "collection": "users",
          "filter": {"user_id": "{user_id}"},
          "find_one": true,
          "output_var": "user_profile"
        }
      },
      "next_step": "log_request"
    },
    {
      "id": "log_request",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_log_message",
        "context_updates": {
          "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –∑–∞–ø—Ä–æ—Å–∏–ª –ª–∞–π—Ñ—Ö–∞–∫: {message_text}",
          "level": "INFO",
          "category": "lifehack_generator"
        }
      },
      "next_step": "check_user_profile"
    },
    {
      "id": "check_user_profile",
      "type": "conditional_branch",
      "params": {
        "condition": "exists({user_profile})",
        "if_true_step": "generate_personalized_lifehack",
        "if_false_step": "generate_generic_lifehack"
      }
    },
    {
      "id": "generate_personalized_lifehack",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_llm_query",
        "context_updates": {
          "prompt": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–∞–π—Ñ—Ö–∞–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n\n–ó–∞–ø—Ä–æ—Å: {message_text}\n\n–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n- –û–ø—ã—Ç –≤ –ò–ò: {user_profile.experience_level}\n- –¶–µ–ª–∏: {user_profile.learning_goals}\n- –ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_profile.interests}\n- –í—Ä–µ–º—è –≤ –Ω–µ–¥–µ–ª—é: {user_profile.weekly_time}\n\n–õ–∞–π—Ñ—Ö–∞–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:\n1. –ü—Ä–∞–∫—Ç–∏—á–Ω—ã–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º\n2. –£—á–∏—Ç—ã–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n3. –°–≤—è–∑–∞–Ω —Å –µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏\n4. –°–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏\n5. –ë—ã—Ç—å –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º\n\n–§–æ—Ä–º–∞—Ç: HTML —Å —ç–º–æ–¥–∑–∏, –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤.",
          "model": "meta-llama/llama-3.2-70b-instruct",
          "temperature": 0.8,
          "max_tokens": 800,
          "output_var": "lifehack_text"
        }
      },
      "next_step": "save_to_history"
    },
    {
      "id": "generate_generic_lifehack",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_llm_query",
        "context_updates": {
          "prompt": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–ª–µ–∑–Ω—ã–π –ª–∞–π—Ñ—Ö–∞–∫ –Ω–∞ —Ç–µ–º—É: {message_text}\n\n–õ–∞–π—Ñ—Ö–∞–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:\n1. –ü—Ä–∞–∫—Ç–∏—á–Ω—ã–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º –≤ –∂–∏–∑–Ω–∏\n2. –°–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏\n3. –ë—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è\n4. –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º\n\n–§–æ—Ä–º–∞—Ç: HTML —Å —ç–º–æ–¥–∑–∏, –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤.",
          "model": "meta-llama/llama-3.2-70b-instruct",
          "temperature": 0.8,
          "max_tokens": 800,
          "output_var": "lifehack_text"
        }
      },
      "next_step": "save_to_history"
    },
    {
      "id": "save_to_history",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_mongo_save_data",
        "context_updates": {
          "collection": "lifehacks_history",
          "document": {
            "user_id": "{user_id}",
            "chat_id": "{chat_id}",
            "request": "{message_text}",
            "lifehack": "{lifehack_text}",
            "personalized": "exists({user_profile})",
            "created_at": "{current_time}"
          }
        }
      },
      "next_step": "send_response"
    },
    {
      "id": "send_response",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_message",
        "context_updates": {
          "text": "üí° <b>–õ–∞–π—Ñ—Ö–∞–∫ –¥–ª—è —Ç–µ–±—è:</b>\n\n{lifehack_text}\n\n<i>üí¨ –•–æ—á–µ—à—å –µ—â–µ –ª–∞–π—Ñ—Ö–∞–∫? –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Ç–µ–º—É!</i>",
          "parse_mode": "HTML"
        }
      },
      "next_step": "offer_daily_subscription"
    },
    {
      "id": "offer_daily_subscription",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "üìÖ <b>–•–æ—á–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ª–∞–π—Ñ—Ö–∞–∫–∏?</b>",
          "buttons": [
            [{"text": "‚úÖ –î–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è", "callback_data": "daily_lifehacks_on"}],
            [{"text": "‚ùå –ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ", "callback_data": "daily_lifehacks_off"}]
          ]
        }
      },
      "next_step": "wait_subscription_choice"
    },
    {
      "id": "wait_subscription_choice",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 60,
        "output_var": "subscription_choice"
      },
      "next_step": "handle_subscription"
    },
    {
      "id": "handle_subscription",
      "type": "conditional_branch",
      "params": {
        "condition": "{subscription_choice} == 'daily_lifehacks_on'",
        "if_true_step": "enable_daily_lifehacks",
        "if_false_step": "end"
      }
    },
    {
      "id": "enable_daily_lifehacks",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_scheduler_create_task",
        "context_updates": {
          "scenario_id": "daily_lifehack_delivery",
          "delay_minutes": 1440,
          "task_context": {
            "subscription_type": "daily_lifehacks",
            "user_profile": "{user_profile}"
          }
        }
      },
      "next_step": "confirm_subscription"
    },
    {
      "id": "confirm_subscription",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_message",
        "context_updates": {
          "text": "‚úÖ <b>–û—Ç–ª–∏—á–Ω–æ!</b> –¢–µ–ø–µ—Ä—å —Ç—ã –±—É–¥–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∞–π—Ñ—Ö–∞–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00.\n\n<i>–ß—Ç–æ–±—ã –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è, –Ω–∞–ø–∏—à–∏ \"–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –ª–∞–π—Ñ—Ö–∞–∫–æ–≤\"</i>",
          "parse_mode": "HTML"
        }
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end"
    }
  ]
} 