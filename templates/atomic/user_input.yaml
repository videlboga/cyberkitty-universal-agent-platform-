# üìù –ê–¢–û–ú–ê–†–ù–´–ô –ë–õ–û–ö: –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

atomic_template: "user_input"
version: "1.0"
description: "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π"
author: "Universal Agent System"

# ===== –ü–ê–†–ê–ú–ï–¢–†–´ =====
parameters:
  prompt:
    type: "string"
    description: "–¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"
    required: true
  
  placeholder:
    type: "string"
    description: "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞"
    default: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..."
  
  validation_type:
    type: "string"
    description: "–¢–∏–ø –≤–∞–ª–∏–¥–∞—Ü–∏–∏: text, number, email, url, none"
    default: "text"
  
  min_length:
    type: "integer"
    description: "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–≤–æ–¥–∞"
    default: 1
  
  max_length:
    type: "integer"
    description: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–≤–æ–¥–∞"
    default: 1000
  
  timeout:
    type: "integer"
    description: "–¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö"
    default: 300
  
  output_var:
    type: "string"
    description: "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    default: "user_input"
  
  retry_on_invalid:
    type: "boolean"
    description: "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –≤–≤–æ–¥–µ"
    default: true
  
  cancel_button:
    type: "boolean"
    description: "–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω—ã"
    default: true

# ===== –®–ê–ì–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø =====
steps:
  - id: "input_start"
    type: "log_message"
    params:
      message: "üìù –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–≤–æ–¥: {prompt}"
      level: "INFO"
    next_step: "send_prompt"
  
  - id: "send_prompt"
    type: "telegram_send_message"
    params:
      text: "{prompt}"
      placeholder: "{placeholder}"
      wait_for_input: true
      input_type: "{validation_type}"
      timeout: "{timeout}"
      output_var: "{output_var}"
      cancel_button: "{cancel_button}"
    next_step: "validate_input"
  
  - id: "validate_input"
    type: "action"
    params:
      action_type: "validate_input"
      input_var: "{output_var}"
      validation_type: "{validation_type}"
      min_length: "{min_length}"
      max_length: "{max_length}"
      output_var: "validation_result"
    next_step: "check_validation"
  
  - id: "check_validation"
    type: "branch"
    params:
      condition: "{validation_result.valid}"
      if_true: "input_success"
      if_false: "input_invalid"
  
  - id: "input_invalid"
    type: "telegram_send_message"
    params:
      text: "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥: {validation_result.error}\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    next_step: "retry_check"
  
  - id: "retry_check"
    type: "branch"
    params:
      condition: "{retry_on_invalid}"
      if_true: "send_prompt"
      if_false: "input_failed"
  
  - id: "input_failed"
    type: "action"
    params:
      action_type: "update_context"
      updates:
        input_failed: true
        input_error: "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –≤–≤–æ–¥–∞"
    next_step: "input_end"
  
  - id: "input_success"
    type: "action"
    params:
      action_type: "update_context"
      updates:
        input_completed: true
        input_valid: true
    next_step: "input_end"
  
  - id: "input_end"
    type: "log_message"
    params:
      message: "‚úÖ –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω: {{{output_var}}}"
      level: "INFO"

# ===== –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø =====
examples:
  - name: "–ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥"
    parameters:
      prompt: "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"
      validation_type: "text"
      min_length: 2
      max_length: 50
      output_var: "user_name"

  - name: "Email –∞–¥—Ä–µ—Å"
    parameters:
      prompt: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email –∞–¥—Ä–µ—Å:"
      validation_type: "email"
      placeholder: "example@domain.com"
      output_var: "user_email"

  - name: "–ß–∏—Å–ª–æ–≤–æ–π –≤–≤–æ–¥"
    parameters:
      prompt: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç:"
      validation_type: "number"
      min_length: 1
      max_length: 3
      output_var: "user_age"

  - name: "URL —Å—Å—ã–ª–∫–∞"
    parameters:
      prompt: "–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à —Å–∞–π—Ç:"
      validation_type: "url"
      placeholder: "https://example.com"
      output_var: "user_website"

# ===== –¢–†–ï–ë–û–í–ê–ù–ò–Ø =====
requirements:
  plugins:
    - "TelegramPlugin"  # –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–≤–æ–¥–∞
  
  context_variables:
    - "prompt"          # –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞

# ===== –†–ï–ó–£–õ–¨–¢–ê–¢ =====
output:
  context_updates:
    - "{output_var}": "–í–≤–µ–¥–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ç–µ–∫—Å—Ç"
    - "input_completed": "true –µ—Å–ª–∏ –≤–≤–æ–¥ —É—Å–ø–µ—à–µ–Ω"
    - "input_valid": "true –µ—Å–ª–∏ –≤–≤–æ–¥ –ø—Ä–æ—à–µ–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é"
    - "input_failed": "true –µ—Å–ª–∏ –≤–≤–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è"
    - "validation_result": "–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏" 