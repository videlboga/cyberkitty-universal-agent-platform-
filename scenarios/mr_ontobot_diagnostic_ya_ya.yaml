scenario_id: mr_ontobot_diagnostic_ya_ya
name: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–Ø
description: –ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ - —Å—Ñ–µ—Ä–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Å–µ–±–µ
initial_context:
  current_diagnostic_stage: ya_ya
  ya_ya_response: null
  examples_viewed: false
steps:
- id: start
  type: start
  next_step: send_ya_ya_video
- id: send_ya_ya_video
  type: channel_action
  params:
    action: forward_message
    chat_id: '{chat_id}'
    from_chat_id: '-1002614708769'
    message_id: 4
  next_step: show_ya_ya_options
- id: show_ya_ya_options
  type: channel_action
  params:
    action: send_buttons
    chat_id: '{chat_id}'
    text: –ü–æ—Å–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ –∏ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏–µ
    buttons:
    - - text: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤
        callback_data: view_ya_ya_examples
    - - text: –ù–∞–ø–∏—Å–∞—Ç—å –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã ¬´–Ø-–Ø¬ª
        callback_data: write_ya_ya_viruses
  next_step: wait_for_ya_ya_choice
- id: wait_for_ya_ya_choice
  type: input
  params:
    waiting_for: callback_query
    expected_values:
    - view_ya_ya_examples
    - write_ya_ya_viruses
    input_type: text
  next_step: process_choice
- id: process_choice
  type: branch
  params:
    conditions:
    - condition: callback_data == 'view_ya_ya_examples'
      next_step: show_examples
    - condition: callback_data == 'write_ya_ya_viruses'
      next_step: provide_instructions
    default_next_step: show_examples
- id: show_examples
  type: channel_action
  params:
    action: send_message
    chat_id: '{chat_id}'
    text: 'üìä **–ü—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ ¬´–Ø-–Ø¬ª:**


      ‚Ä¢ "–Ø –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–º–Ω—ã–π"

      ‚Ä¢ "–Ø –Ω–µ –∑–∞—Å–ª—É–∂–∏–≤–∞—é —É—Å–ø–µ—Ö–∞"

      ‚Ä¢ "–Ø –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞—é –æ—à–∏–±–∫–∏"

      ‚Ä¢ "–Ø –Ω–µ –º–æ–≥—É –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é –∂–∏–∑–Ω—å"

      ‚Ä¢ "–Ø —Ö—É–∂–µ –¥—Ä—É–≥–∏—Ö"

      ‚Ä¢ "–ú–Ω–µ –Ω–µ –≤–µ–∑–µ—Ç –≤ –∂–∏–∑–Ω–∏"

      ‚Ä¢ "–Ø —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–π/–º–æ–ª–æ–¥–æ–π –¥–ª—è —ç—Ç–æ–≥–æ"

      ‚Ä¢ "–£ –º–µ–Ω—è –Ω–µ—Ç —Ç–∞–ª–∞–Ω—Ç–∞"


      –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π –Ω–∞–π—Ç–∏ —Å–≤–æ–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã!

      '
  next_step: update_examples_viewed
- id: update_examples_viewed
  type: action
  params:
    action_type: update_context
    updates:
      examples_viewed: true
  next_step: provide_instructions
- id: provide_instructions
  type: channel_action
  params:
    action: send_message
    chat_id: '{chat_id}'
    text: 'üìù **–ó–∞–¥–∞–Ω–∏–µ ¬´–Ø-–Ø¬ª**


      –ù–∞–ø–∏—à–∏ 5-10 —Å–≤–æ–∏—Ö –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –æ —Å–µ–±–µ - –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —É–±–µ–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç
      —Ç–µ–±—è.


      –≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –º—ã—Å–ª–∏ –æ:

      ‚Ä¢ –¢–≤–æ–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö

      ‚Ä¢ –í–Ω–µ—à–Ω–æ—Å—Ç–∏

      ‚Ä¢ –•–∞—Ä–∞–∫—Ç–µ—Ä–µ

      ‚Ä¢ –î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞—Ö/–Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞—Ö

      ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö


      –ë—É–¥—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–µ—Å—Ç–Ω—ã–º - —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–æ—á–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.


      –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:

      '
  next_step: wait_for_response
- id: wait_for_response
  type: input
  params:
    waiting_for: text
    timeout_seconds: 3600
    variable: response_text
  next_step: save_ya_ya_response
- id: save_ya_ya_response
  type: mongo_upsert_document
  params:
    collection: ontobot_responses
    filter:
      user_id: '{user_id}'
    document:
      user_id: '{user_id}'
      chat_id: '{chat_id}'
      response_type: ya_ya
      response_text: '{response_text}'
      completed_at: '{current_timestamp}'
  next_step: find_amocrm_contact_ya_ya
- id: find_amocrm_contact_ya_ya
  type: amocrm_find_contact
  params:
    query: "{user_id}"
    output_var: amocrm_contact_search
  next_step: update_amocrm_contact_ya_ya
- id: update_amocrm_contact_ya_ya
  type: amocrm_update_contact
  params:
    contact_id: "{amocrm_contact_search.contact.id}"
    custom_fields:
      DIAGNOSTIC_STAGE: "ya_ya_completed"
      YA_YA_RESPONSE: "{response_text}"
      YA_YA_COMPLETED_AT: "{current_timestamp}"
    used_fields_map: true
    output_var: amocrm_update_result
  next_step: add_ya_ya_note
- id: add_ya_ya_note
  type: amocrm_add_note
  params:
    entity_type: "contacts"
    entity_id: "{amocrm_contact_search.contact.id}"
    note_type: "common"
    note_text: "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ \"–Ø-–Ø\" –∑–∞–≤–µ—Ä—à–µ–Ω–∞\n\nüìÖ –î–∞—Ç–∞: {current_timestamp}\nüë§ –ò–º—è: {contact.first_name} {contact.last_name}\nüí≠ –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {response_text}\n\nüéØ –≠—Ç–∞–ø 1/3 –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω."
    output_var: note_result
  next_step: switch_to_ya_delo
- id: switch_to_ya_delo
  type: switch_scenario
  params:
    scenario_id: mr_ontobot_diagnostic_ya_delo
    context:
      ya_ya_response: '{response_text}'
      user_id: '{user_id}'
      chat_id: '{chat_id}'
  next_step: end
- id: end
  type: end
