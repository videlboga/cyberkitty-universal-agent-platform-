scenario_id: mr_ontobot_diagnostic_ya_relations
name: "OntoBot –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è"
description: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –≤ –æ–±–ª–∞—Å—Ç–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ —Å–±–æ—Ä –∫–æ–Ω—Ç–∞–∫—Ç–∞"
initial_context:
  bot_name: "mr_ontobot"
  current_stage: "diagnostic_ya_relations"

steps:
  - id: start
    type: start
    params:
      message: "üéØ **–≠—Ç–∞–ø 3: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è**"
    next_step: send_ya_relations_video

  - id: send_ya_relations_video
    type: channel_action
    params:
      action: copy_message
      chat_id: "{chat_id}"
      from_chat_id: "-1002614708769"
      message_id: 6
      disable_notification: true
    next_step: show_ya_relations_options

  - id: show_ya_relations_options
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "üìù **–ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:**"
      reply_markup:
        inline_keyboard:
          - - text: "üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤"
              callback_data: "view_ya_relations_examples"
          - - text: "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã"
              callback_data: "write_ya_relations_viruses"
    next_step: wait_for_ya_relations_choice

  - id: wait_for_ya_relations_choice
    type: input
    params:
      input_type: "callback_query"
      expected_callbacks: ["view_ya_relations_examples", "write_ya_relations_viruses"]
      timeout: 3600
    next_step: handle_ya_relations_choice

  - id: handle_ya_relations_choice
    type: branch
    params:
      condition: "{callback_data}"
      branches:
        "view_ya_relations_examples": show_ya_relations_examples
        "write_ya_relations_viruses": ask_ya_relations_response
    next_step: end

  - id: show_ya_relations_examples
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "üëÅÔ∏è **–ü—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è:**\n\n‚Ä¢ \"–ú–µ–Ω—è –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç\"\n‚Ä¢ \"–Ø –Ω–µ —É–º–µ—é —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è\"\n‚Ä¢ \"–ú–Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç–∞—é—Ç—Å—è –ø–ª–æ—Ö–∏–µ –ª—é–¥–∏\"\n‚Ä¢ \"–Ø –±–æ—é—Å—å –±–ª–∏–∑–æ—Å—Ç–∏\"\n‚Ä¢ \"–í—Å–µ –º–µ–Ω—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç\"\n\nüí° *–£–∑–Ω–∞–ª–∏ —Å–µ–±—è? –¢–µ–ø–µ—Ä—å –æ–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏!*"
      reply_markup:
        inline_keyboard:
          - - text: "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã"
              callback_data: "write_ya_relations_viruses"
    next_step: wait_write_ya_relations

  - id: wait_write_ya_relations
    type: input
    params:
      input_type: "callback_query"
      expected_callbacks: ["write_ya_relations_viruses"]
      timeout: 3600
    next_step: ask_ya_relations_response

  - id: ask_ya_relations_response
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "‚úçÔ∏è **–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã –≤ –æ–±–ª–∞—Å—Ç–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π**\n\n–ù–∞–ø—Ä–∏–º–µ—Ä:\n‚Ä¢ –ß—Ç–æ –º–µ—à–∞–µ—Ç –≤–∞–º –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Å –ª—é–¥—å–º–∏?\n‚Ä¢ –ö–∞–∫–∏–µ —Å—Ç—Ä–∞—Ö–∏ –µ—Å—Ç—å –≤ –æ–±—â–µ–Ω–∏–∏?\n‚Ä¢ –ß—Ç–æ –≤–∞—Å —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤ –ª—é–¥—è—Ö?\n\n*–ë—É–¥—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.*"
    next_step: wait_ya_relations_response

  - id: wait_ya_relations_response
    type: input
    params:
      input_type: "text"
      timeout: 3600
    next_step: save_ya_relations_response

  - id: save_ya_relations_response
    type: mongo_upsert_document
    params:
      collection: "ontobot_responses"
      filter:
        user_id: "{user_id}"
        bot_name: "mr_ontobot"
      document:
        user_id: "{user_id}"
        bot_name: "mr_ontobot"
        ya_relations_response: "{user_input}"
        telegram_username: "{telegram_username}"
        telegram_first_name: "{telegram_first_name}"
        updated_at: "{current_datetime}"
      output_var: "save_response_result"
    next_step: request_contact

  - id: request_contact
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "üìû **–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º**\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞:"
      reply_markup:
        keyboard:
          - - text: "üìû –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"
              request_contact: true
        resize_keyboard: true
        one_time_keyboard: true
    next_step: wait_for_contact

  - id: wait_for_contact
    type: input
    params:
      input_type: "contact"
      timeout: 3600
    next_step: switch_to_contact_collection

  - id: switch_to_contact_collection
    type: switch_scenario
    params:
      scenario_id: "mr_ontobot_contact_collection"
      context_merge: true
    next_step: end

  - id: end
    type: end
    params:
      message: "–≠—Ç–∞–ø –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω" 