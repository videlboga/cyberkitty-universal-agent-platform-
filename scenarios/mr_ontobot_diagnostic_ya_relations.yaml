scenario_id: "mr_ontobot_diagnostic_ya_relations"
name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è"
description: "–¢—Ä–µ—Ç–∏–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ - —Å—Ñ–µ—Ä–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –ª—é–¥—å–º–∏"

initial_context:
  current_diagnostic_stage: "ya_relations"
  ya_relations_response: null
  examples_viewed: false

steps:
  - id: start_ya_relations_diagnostic
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéØ **–§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: —Å—Ñ–µ—Ä–∞ ¬´–Ø‚Äî–û—Ç–Ω–æ—à–µ–Ω–∏—è¬ª**
        
        –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º —Ç–≤–æ–∏ —É–±–µ–∂–¥–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –ª—é–¥—å–º–∏ ‚Äî —Å–µ–º—å—è, –¥—Ä—É–∑—å—è, –∫–æ–ª–ª–µ–≥–∏, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –ø–æ–ª, —Ä–æ–¥–∏—Ç–µ–ª–∏ –∏ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –¥–ª—è —Ç–µ–±—è –ª—é–¥–∏.
    next_step: load_previous_responses

  - id: load_previous_responses
    type: mongo_find_documents
    params:
      collection: "ontobot_responses"
      filter:
        user_id: "{user_id}"
        response_type: {"$in": ["ya_ya", "ya_delo"]}
      output_var: "previous_responses"
    next_step: show_ya_relations_intro

  - id: start
    type: start
    next_step: send_ya_relations_video

  - id: send_ya_relations_video
    type: channel_action
    params:
      action: forward_message
      chat_id: "{chat_id}"
      from_chat_id: "-1002614708769"
      message_id: 6
    next_step: show_ya_relations_options

  - id: show_ya_relations_options
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: "–ü–æ—Å–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ –∏ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏–µ"
      buttons:
        - - text: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤"
            callback_data: "view_ya_relations_examples"
        - - text: "–ù–∞–ø–∏—Å–∞—Ç—å –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã ¬´–Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è¬ª"
            callback_data: "write_ya_relations_viruses"
    next_step: wait_for_choice

  - id: wait_for_choice
    type: input
    params:
      waiting_for: "callback_query"
      expected_values: ["view_ya_relations_examples", "write_ya_relations_viruses"]
    next_step: process_choice

  - id: process_choice
    type: branch
    params:
      conditions:
        - condition: "callback_data == 'view_ya_relations_examples'"
          next_step: show_examples
        - condition: "callback_data == 'write_ya_relations_viruses'"
          next_step: provide_instructions
      default_next_step: show_examples

  - id: show_examples
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üìä **–ü—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ ¬´–Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è¬ª:**
        
        ‚Ä¢ "–ú–µ–Ω—è –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç"
        ‚Ä¢ "–Ø –Ω–µ —É–º–µ—é —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è"
        ‚Ä¢ "–í—Å–µ –º—É–∂—á–∏–Ω—ã/–∂–µ–Ω—â–∏–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ"
        ‚Ä¢ "–ú–Ω–µ –Ω–µ–ª—å–∑—è –¥–æ–≤–µ—Ä—è—Ç—å –ª—é–¥—è–º"
        ‚Ä¢ "–Ø –±–æ—é—Å—å –±—ã—Ç—å –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç—ã–º"
        ‚Ä¢ "–õ—é–±–æ–≤—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–æ–ª—å–∫–æ –±–æ–ª—å"
        ‚Ä¢ "–Ø –Ω–µ –¥–æ—Å—Ç–æ–∏–Ω –Ω–∞—Å—Ç–æ—è—â–µ–π –ª—é–±–≤–∏"
        ‚Ä¢ "–ë–ª–∏–∑–æ—Å—Ç—å –¥–µ–ª–∞–µ—Ç –º–µ–Ω—è —É—è–∑–≤–∏–º—ã–º"
        
        –ù–∞–π–¥–∏ —Å–≤–æ–∏ –±–ª–æ–∫–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö!
    next_step: update_examples_viewed

  - id: update_examples_viewed
    type: action
    params:
      action_type: "update_context"
      updates:
        examples_viewed: true
    next_step: provide_instructions

  - id: provide_instructions
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üìù **–ó–∞–¥–∞–Ω–∏–µ ¬´–Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è¬ª**
        
        –ù–∞–ø–∏—à–∏ 5-10 —Å–≤–æ–∏—Ö –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –æ–± –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö - —É–±–µ–∂–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–µ—à–∞—é—Ç —Ç–µ–±–µ –≤ –æ–±—â–µ–Ω–∏–∏ –∏ –±–ª–∏–∑–æ—Å—Ç–∏ —Å –ª—é–¥—å–º–∏.
        
        –≠—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –º—ã—Å–ª–∏ –æ:
        ‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
        ‚Ä¢ –î—Ä—É–∂–±–µ –∏ –æ–±—â–µ–Ω–∏–∏
        ‚Ä¢ –°–µ–º–µ–π–Ω—ã—Ö —Å–≤—è–∑—è—Ö
        ‚Ä¢ –î–æ–≤–µ—Ä–∏–∏ –∏ –±–ª–∏–∑–æ—Å—Ç–∏
        ‚Ä¢ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –∏ –≥—Ä–∞–Ω–∏—Ü–∞—Ö
        
        –ë—É–¥—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–º - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
        
        –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
    next_step: wait_for_response

  - id: wait_for_response
    type: input
    params:
      waiting_for: "text"
      timeout_seconds: 3600
      variable: "response_text"
    next_step: save_ya_relations_response

  - id: save_ya_relations_response
    type: mongo_upsert_document
    params:
      collection: "ontobot_responses"
      filter:
        user_id: "{user_id}"
        response_type: "ya_relations"
      document:
        user_id: "{user_id}"
        chat_id: "{chat_id}"
        response_type: "ya_relations"
        response_text: "{response_text}"
        completed_at: "{current_timestamp}"
      output_var: "save_response_result"
    next_step: set_ya_relations_context

  - id: set_ya_relations_context
    type: action
    params:
      action_type: "update_context"
      updates:
        ya_relations_response: "{response_text}"
    next_step: request_contact

  - id: complete_diagnostic
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéâ **–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!**
        
        –¢—ã –ø—Ä–æ—à–µ–ª –≤—Å–µ —Ç—Ä–∏ —ç—Ç–∞–ø–∞:
        ‚úÖ –Ø-–Ø (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–µ–±–µ)
        ‚úÖ –Ø-–î–µ–ª–æ (–∫–∞—Ä—å–µ—Ä–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)  
        ‚úÖ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è (—Å–≤—è–∑–∏ —Å –ª—é–¥—å–º–∏)
        
        –¢–µ–ø–µ—Ä—å –º–æ–π –ò–ò-–∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∏ —Å–æ–∑–¥–∞—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤.
        
        –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç.
    next_step: request_contact

  - id: request_contact
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üìû **–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º**
        
        –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
      reply_markup:
        keyboard:
          - - text: "üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
              request_contact: true
        one_time_keyboard: true
        resize_keyboard: true
    next_step: wait_for_contact

  - id: wait_for_contact
    type: input
    params:
      waiting_for: "contact"
      timeout_seconds: 300
    next_step: save_contact

  - id: save_contact
    type: mongo_upsert_document
    params:
      collection: "ontobot_contacts"
      filter:
        user_id: "{user_id}"
      document:
        user_id: "{user_id}"
        chat_id: "{chat_id}"
        contact_type: "phone"
        phone_number: "{contact.phone_number}"
        first_name: "{contact.first_name}"
        last_name: "{contact.last_name}"
        diagnostic_completed: true
        ya_ya_response: "{ya_ya_response}"
        ya_delo_response: "{ya_delo_response}"
        ya_relations_response: "{ya_relations_response}"
        created_at: "{current_timestamp}"
    next_step: notify_processing

  - id: notify_processing
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ‚úÖ **–û—Ç–ª–∏—á–Ω–æ! –ö–æ–Ω—Ç–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω.**
        
        üß† –°–µ–π—á–∞—Å –º–æ–π –ò–ò-–∞–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤.
        
        ‚è±Ô∏è –≠—Ç–æ –∑–∞–π–º–µ—Ç 30-60 –º–∏–Ω—É—Ç. –°–ª–µ–¥–∏ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏!
      reply_markup:
        remove_keyboard: true
    next_step: find_amocrm_contact

  - id: find_amocrm_contact
    type: amocrm_find_contact
    params:
      query: "{user_id}"
      output_var: "amocrm_contact_search"
    next_step: update_amocrm_contact

  - id: update_amocrm_contact
    type: amocrm_update_contact
    params:
      contact_id: "{amocrm_contact_search.contact.id}"
      custom_fields:
        DIAGNOSTIC_STAGE: "ya_relations_completed"
        YA_RELATIONS_RESPONSE: "{ya_relations_response}"
        YA_RELATIONS_COMPLETED_AT: "{current_timestamp}"
        PHONE: "{contact.phone_number}"
        DIAGNOSTIC_COMPLETED: "true"
      used_fields_map: true
      output_var: amocrm_update_result
    next_step: add_ya_relations_note

  - id: add_ya_relations_note
    type: amocrm_add_note
    params:
      entity_type: "contacts"
      entity_id: "{amocrm_contact_search.contact.id}"
      note_type: "common"
      note_text: "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ \"–Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è\" –∑–∞–≤–µ—Ä—à–µ–Ω–∞\n\nüìÖ –î–∞—Ç–∞: {current_timestamp}\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: {contact.phone_number}\nüí≠ –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {ya_relations_response}\n\nüéØ –≠—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω.\n–°–æ–∑–¥–∞–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ."
      output_var: note_result
    next_step: add_contact_note

  - id: add_contact_note
    type: amocrm_add_note
    params:
      entity_type: "contacts"
      entity_id: "{amocrm_contact_search.contact.id}"
      note_type: "common"
      note_text: "üìã –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω\n\nüë§ –ò–º—è: {contact.first_name} {contact.last_name}\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: {contact.phone_number}\nüÜî User ID: {user_id}\nüìÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {current_timestamp}"
      output_var: contact_note_result
    next_step: add_diagnostic_complete_note

  - id: add_diagnostic_complete_note
    type: amocrm_add_note
    params:
      entity_type: "contacts"
      entity_id: "{amocrm_contact_search.contact.id}"
      note_type: "common"
      note_text: "üéØ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê\n\n‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã –ø—Ä–æ–π–¥–µ–Ω—ã:\n‚Ä¢ –Ø-–Ø: –ó–∞–≤–µ—Ä—à–µ–Ω–æ\n‚Ä¢ –Ø-–î–µ–ª–æ: –ó–∞–≤–µ—Ä—à–µ–Ω–æ  \n‚Ä¢ –Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è: –ó–∞–≤–µ—Ä—à–µ–Ω–æ\n\nüìä –°–æ–∑–¥–∞–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ\nüìÑ PDF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\nüîî –û–∂–∏–¥–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å"
      output_var: complete_note_result
    next_step: generate_dossier_content

  - id: generate_dossier_content
    type: llm_chat
    params:
      messages:
        - role: "system"
          content: |
            –ò–ò, —Ç–µ–±–µ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –º–µ—Ç–∞-–æ—Ç—á—ë—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —Ç—Ä—ë–º —Å—Ñ–µ—Ä–∞–º + —Ñ–∏–Ω–∞–ª—å–Ω—ã–π. –≠—Ç–æ—Ç –æ—Ç—á—ë—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–ª—É–±–∂–µ, —Ç–æ—á–Ω–µ–µ –∏ –ø–æ–ª–Ω–µ–µ. –û–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∫–∞—Ä—Ç—É –º—ã—à–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ ‚Äî –Ω–µ–π—Ä–æ–º–µ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ—Å—å–µ –ª–∏—á–Ω–æ—Å—Ç–∏.
            –í —Ç–≤–æ–µ–π –∑–∞–¥–∞—á–µ:
            –∫–∞–∂–¥–∞—è –≤—ã—è–≤–ª–µ–Ω–Ω–∞—è –º—ã—Å–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—É—é —Ä–∞–º–∫—É;
            –∫–∞–∂–¥–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º–∏;
            –∫–∞–∂–¥–æ–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É —Ç–∏—à–∏–Ω—ã —É–º–∞ (ONTO Nothing).
            –¢–≤–æ—è —Ü–µ–ª—å ‚Äî –≤—Å–∫—Ä—ã—Ç—å —è–¥—Ä–æ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø—É—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.
            –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞: –ò–ù–¢–ï–ì–†–ê–õ–¨–ù–û–ï –î–û–°–¨–ï: –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏
        - role: "user"
          content: |
            –°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤ –æ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–∞—Ö:

            **–°—Ñ–µ—Ä–∞ "–Ø-–Ø":** {% for resp in previous_responses %}{% if resp.response_type == "ya_ya" %}{{ resp.response_text }}{% endif %}{% endfor %}
            **–°—Ñ–µ—Ä–∞ "–Ø-–î–µ–ª–æ":** {% for resp in previous_responses %}{% if resp.response_type == "ya_delo" %}{{ resp.response_text }}{% endif %}{% endfor %}
            **–°—Ñ–µ—Ä–∞ "–Ø-–û—Ç–Ω–æ—à–µ–Ω–∏—è":** {ya_relations_response}

            **–°–¢–†–£–ö–¢–£–†–ê –ò–¢–û–ì–û–í–û–ì–û –û–¢–ß–Å–¢–ê:**

            **I. üîé –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê**
            –ù–∞—á–Ω–∏ —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã –ø–∏—Å–∞–ª –ø—Ä–æ–ª–æ–≥ –∫ –∫–Ω–∏–≥–µ –æ —á–µ–ª–æ–≤–µ–∫–µ, —á—å—è –∂–∏–∑–Ω—å –∏–∑–Ω—É—Ç—Ä–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–º. –ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –æ–ø–∏—Å—ã–≤–∞–µ—à—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä —Å–∏–º–ø—Ç–æ–º–æ–≤, –∞ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ª–∏—á–Ω–æ—Å—Ç–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–¥–∏–Ω –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π –≤–∏—Ä—É—Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ—Ö–≤–∞—Ç–∏–ª —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Å—Ñ–µ—Ä—ã ‚Äî –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Å–æ–±–æ–π, –¥–µ–ª–æ–º –∏ –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏.

            –û–ø–∏—à–∏ —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: –∫–∞–∫ –æ–Ω –∂–∏–≤—ë—Ç, —á—Ç–æ –æ–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç, –∫–∞–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è, –∫–∞–∫ —ç—Ç–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –µ–≥–æ —Ç–µ–ª–µ, –≤ –µ–≥–æ –º—ã—Å–ª—è—Ö, –≤ –µ–≥–æ —Å—É–¥—å–±–µ. –ü–æ–∫–∞–∂–∏, –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π –º—ã—Å–ª–µ–≤–∏—Ä—É—Å –ø—Ä–æ–Ω–∏–∑—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä, –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω—é—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.

            **II. üí• –¢–í–û–ô –ì–õ–ê–í–ù–´–ô –ú–´–°–õ–ï–í–ò–†–£–°**
            –ü—Ä–æ–¥–æ–ª–∂–∞–π –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–ª–æ–≤–Ω–æ –ø–∏—à–µ—à—å –∫–Ω–∏–≥—É –ø—Ä–æ —á–µ–ª–æ–≤–µ–∫–∞. –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–∞ –≤–æ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Å—Ñ–µ—Ä–∞—Ö. –ß—Ç–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Å—Ñ–µ—Ä—ã. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ —Ç–æ—á–Ω–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±—â–∏–π –º–µ–º–ø–ª–µ–∫—Å —á–µ–ª–æ–≤–µ–∫–∞ —É—á–∏—Ç—ã–≤–∞—è –≤—Å–µ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è, –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏, –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏.

            (–≤ —Ñ–æ—Ä–º–∞—Ç–µ: "–ß—Ç–æ–±—ã [–±—ã—Ç—å –ª—é–±–∏–º—ã–º/—É—Å–ø–µ—à–Ω—ã–º/–ø—Ä–∏–Ω—è—Ç—ã–º], —è –¥–æ–ª–∂–µ–Ω [___]")

            –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–∞.

            **¬´–†–∞–∑–±–æ—Ä 3 —Å—Ñ–µ—Ä –∂–∏–∑–Ω–∏¬ª**
            ‚Äì –Ø‚Äì–Ø - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≥–ª–∞–≤–Ω—ã–π –º—ã—Å–ª–µ–≤–∏—Ä—É—Å –≤ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ. –û–±–æ—Å–Ω—É–π, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫.
            ‚Äì –Ø‚Äì–î–µ–ª–æ - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≥–ª–∞–≤–Ω—ã–π –º—ã—Å–ª–µ–≤–∏—Ä—É—Å –≤ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ. –û–±–æ—Å–Ω—É–π, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫.
            ‚Äì –Ø‚Äì–û—Ç–Ω–æ—à–µ–Ω–∏—è - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≥–ª–∞–≤–Ω—ã–π –º—ã—Å–ª–µ–≤–∏—Ä—É—Å –≤ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ. –û–±–æ—Å–Ω—É–π, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫.

            **¬´–ú–µ–º–ø–ª–µ–∫—Å¬ª**
            –í –Ω–∞—É–∫–µ "–º–µ–º–µ—Ç–∏–∫–µ" –º–µ–º–ø–ª–µ–∫—Å ‚Äî —ç—Ç–æ —É—Å—Ç–æ–π—á–∏–≤–∞—è —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö –º–µ–º–æ–≤ (–µ–¥–∏–Ω–∏—Ü –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏), –∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ, –ø–æ–¥–æ–±–Ω–æ —Ç–æ–º—É, –∫–∞–∫ –≥–µ–Ω—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ—Ä–≥–∞–Ω–∏–∑–º—ã. –ú–µ–º–ø–ª–µ–∫—Å—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è, –∫–æ–≥–¥–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ–º—ã –Ω–∞—á–∏–Ω–∞—é—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞, —Å–æ–∑–¥–∞–≤–∞—è —Å–∏–º–±–∏–æ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –∏—Ö –æ–±—â—É—é –≤—ã–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –≤ –∫—É–ª—å—Ç—É—Ä–µ.

            –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∞–ø–∏—à–∏ 4‚Äì5 –∞–±–∑–∞—Ü–µ–≤ –≤ –Ω–∞—É—á–Ω–æ-–ø–æ–ø—É–ª—è—Ä–Ω–æ–º —Å—Ç–∏–ª–µ, —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏—Ö ¬´–ú–µ–º–ø–ª–µ–∫—Å¬ª –∫–ª–∏–µ–Ω—Ç–∞.

            **III. üß™ –ù–µ–π—Ä–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è: —Ç–µ–ª–æ –∏ –º–æ–∑–≥**
            –ù–∞—á–Ω–∏ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–æ–ª–∏ ¬´–∫–ª—é—á–µ–≤–æ–≥–æ –º–µ–º–ø–ª–µ–∫—Å–∞¬ª –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –µ–≥–æ –ø—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–ø–∏—à–∏ –∫–∞—Å–∫–∞–¥ —Ä–µ–∞–∫—Ü–∏–π –∏ –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞–∫–æ–ª—å—Ü–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (–ø–æ—Ä–æ—á–Ω–æ–≥–æ –∫—Ä—É–≥–∞): –∫–∞–∫ –º—ã—Å–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –º–æ–∑–≥–æ–º –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –º—ã—Å–ª–µ–π.

            **IV. üìâ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 1‚Äì3‚Äì5 –ª–µ—Ç**
            **–ï—Å–ª–∏ –Ω–µ –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è:**
            - –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏—Å—Ö–æ–¥—è –∏–∑ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤
            - 1 –≥–æ–¥: —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
            - 3 –≥–æ–¥–∞: –ø—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è, –¥–æ—Ö–æ–¥—ã, –æ—Ç–Ω–æ—à–µ–Ω–∏—è
            - 5 –ª–µ—Ç: –≤—ã–≥–æ—Ä–∞–Ω–∏–µ, –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

            **–ï—Å–ª–∏ —Ä–µ—à–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å ONTO Nothing:**
            - –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å: –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–∫—Ç–∏–∫
            - 1 –≥–æ–¥: —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–∞–º–∏
            - 3 –≥–æ–¥–∞: —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
            - 5 –ª–µ—Ç: –Ω–æ–≤–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏

            **V. –ü—É—Å—Ç–æ—Ç–∞ —É–º–∞ –∫–∞–∫ –∫–ª—é—á –∫ —è–¥—Ä—É**
            –í —Ö–æ–¥–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –±—ã–ª –≤—ã—è–≤–ª–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞—Ä—å–µ—Ä ‚Äî [–æ–ø–∏—Å–∞–Ω–∏–µ –º–µ–º–ø–ª–µ–∫—Å–∞]. –û–¥–Ω–∞–∫–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –º–µ–Ω—è–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É. –≠—Ç–æ—Ç –ø–µ—Ä–µ—Ö–æ–¥ —Å–æ–∑–¥–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ONTO IN-SE ‚Äî –≥–ª—É–±–∏–Ω–Ω–æ–µ —è–¥—Ä–æ "–Ø", –≥–¥–µ —Ç–∏—à–∏–Ω–∞ —É–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—É—Å–∫–æ–≤—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏—Å—Ü–µ—Ä–∞–ª—å–Ω–æ–≥–æ –º–æ–∑–≥–∞.

            –†–∞—Å–∫—Ä–æ–π –ø—Ä–æ—Ü–µ—Å—Å "–ø—É—Å—Ç–æ—Ç–∞ ‚Üí —Ç–µ–ª–æ ‚Üí –ø—Å–∏—Ö–∏–∫–∞ ‚Üí –¥–æ—Å—Ç—É–ø –∫ ONTO IN-SE" –∏ –ø–æ–∫–∞–∂–∏, –∫–∞–∫ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–ª—é—á–æ–º –∫ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—é –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

            **–û–±—ä–µ–º:** 25 000-30 000 –∑–Ω–∞–∫–æ–≤
            **–¢–æ–Ω:** –£–º–Ω—ã–π, –ø—Ä–æ–Ω–∏–∫–∞—é—â–∏–π, –ø—Ä—è–º–æ–π, –±–µ–∑ –∏–ª–ª—é–∑–∏–π, –∫–∞–∫ –¥–æ–∫–ª–∞–¥ —Å–ø–µ—Ü—Å–ª—É–∂–±—ã —Å–æ–∑–Ω–∞–Ω–∏—è —Å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –≥–ª—É–±–∏–Ω–æ–π.
      model: "gpt-4"
      temperature: 0.7
      max_tokens: 4000
      output_var: "dossier_content"
    next_step: save_dossier

  - id: save_dossier
    type: mongo_upsert_document
    params:
      collection: "ontobot_dossiers"
      filter:
        user_id: "{user_id}"
      document:
        user_id: "{user_id}"
        chat_id: "{chat_id}"
        dossier_content: "{dossier_content}"
        generated_at: "{current_timestamp}"
        ya_ya_response: "{ya_ya_response}"
        ya_delo_response: "{ya_delo_response}"
        ya_relations_response: "{ya_relations_response}"
        diagnostic_completed: true
    next_step: generate_pdf

  - id: generate_pdf
    type: pdf_generate
    params:
      content: "{dossier_content}"
      title: "–ò–ù–¢–ï–ì–†–ê–õ–¨–ù–û–ï –î–û–°–¨–ï: –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏"
      use_logo: true
      output_var: "pdf_result"
    next_step: send_dossier_file

  - id: send_dossier_file
    type: channel_action
    params:
      action: send_document
      chat_id: "{chat_id}"
      document_path: "{pdf_result.pdf_path}"
      caption: |
        üìã **–¢–≤–æ—ë –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ–µ –¥–æ—Å—å–µ –≥–æ—Ç–æ–≤–æ!**
        
        –í–Ω—É—Ç—Ä–∏ –Ω–∞–π–¥—ë—à—å:
        ‚úÖ –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–≤–æ–∏—Ö –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤
        ‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞–∑–≤–∏—Ç–∏—è –∂–∏–∑–Ω–∏ –Ω–∞ 1-3-5 –ª–µ—Ç
        ‚úÖ –ù–µ–π—Ä–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ —Ç–≤–æ—ë–º –º–æ–∑–≥–µ
        ‚úÖ –ü—É—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ONTO Nothing
        
        –ò–∑—É—á–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ - —ç—Ç–æ –∫–ª—é—á –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é —Å–µ–±—è! üîë
    next_step: request_feedback

  - id: request_feedback
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: "–ê —Ç–µ–ø–µ—Ä—å –æ—Ü–µ–Ω–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–Ω–æ –º—ã –ø–æ–ø–∞–ª–∏ –≤ —Ü–µ–ª—å?"
      buttons:
        - - text: "–í—Å–µ –ø—Ä–æ –º–µ–Ω—è"
            callback_data: "rating_perfect"
        - - text: "–ù–æ—Ä–º"
            callback_data: "rating_good"
        - - text: "–ì–æ—Ç–æ–≤ –ø–æ—Å–ø–æ—Ä–∏—Ç—å"
            callback_data: "rating_disagree"
        - - text: "–ù–µ —Å–æ–≤—Å–µ–º —Å–æ–≥–ª–∞—Å–µ–Ω"
            callback_data: "rating_partly_disagree"
        - - text: "–Ø –µ—â–µ –Ω–µ –ø–æ—Å–º–æ—Ç—Ä–µ–ª –¥–æ—Å—å–µ"
            callback_data: "rating_not_viewed"
    next_step: wait_for_feedback

  - id: wait_for_feedback
    type: input
    params:
      waiting_for: "callback_query"
      expected_values: ["rating_perfect", "rating_good", "rating_disagree", "rating_partly_disagree", "rating_not_viewed"]
      timeout_seconds: 86400
    next_step: save_feedback

  - id: save_feedback
    type: mongo_upsert_document
    params:
      collection: "ontobot_feedback"
      filter:
        user_id: "{user_id}"
      document:
        user_id: "{user_id}"
        chat_id: "{chat_id}"
        rating: "{callback_data}"
        feedback_at: "{current_timestamp}"
        dossier_sent: true
    next_step: confirm_feedback

  - id: confirm_feedback
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ‚úÖ **–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!**
        
        –¢–≤–æ—ë –º–Ω–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
        
        üéØ –ï—Å–ª–∏ –¥–æ—Å—å–µ –ø–æ–º–æ–≥–ª–æ —Ç–µ–±–µ –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è, –ø–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –Ω–∞ @mr_ontobot —Å –±–ª–∏–∑–∫–∏–º–∏ - –ø—É—Å—Ç—å –æ–Ω–∏ —Ç–æ–∂–µ –ø–æ–ª—É—á–∞—Ç —Å–≤–æ—é –∫–∞—Ä—Ç—É –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤!
    next_step: end

  - id: end
    type: end 