scenario_id: mr_ontobot_diagnostic_ya_delo
name: "OntoBot –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–î–µ–ª–æ"
description: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –≤ –æ–±–ª–∞—Å—Ç–∏ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
initial_context:
  bot_name: "mr_ontobot"
  current_stage: "diagnostic_ya_delo"

steps:
  - id: start
    type: start
    params:
      message: "üéØ **–≠—Ç–∞–ø 2: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ø-–î–µ–ª–æ**"
    next_step: send_ya_delo_video

  - id: send_ya_delo_video
    type: channel_action
    params:
      action: copy_message
      chat_id: "{chat_id}"
      from_chat_id: "-1002614708769"
      message_id: 5
      disable_notification: true
    next_step: show_ya_delo_options

  - id: show_ya_delo_options
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "üìù **–ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:**"
      reply_markup:
        inline_keyboard:
          - - text: "üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤"
              callback_data: "view_ya_delo_examples"
          - - text: "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã"
              callback_data: "write_ya_delo_viruses"
    next_step: wait_for_ya_delo_choice

  - id: wait_for_ya_delo_choice
    type: input
    params:
      input_type: "callback_query"
      expected_callbacks: ["view_ya_delo_examples", "write_ya_delo_viruses"]
      timeout: 3600
    next_step: handle_ya_delo_choice

  - id: handle_ya_delo_choice
    type: branch
    params:
      condition: "{callback_data}"
      branches:
        "view_ya_delo_examples": show_ya_delo_examples
        "write_ya_delo_viruses": ask_ya_delo_response
    next_step: end

  - id: show_ya_delo_examples
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "üëÅÔ∏è **–ü—Ä–∏–º–µ—Ä—ã –º—ã—Å–ª–µ–≤–∏—Ä—É—Å–æ–≤ –Ø-–î–µ–ª–æ:**\n\n‚Ä¢ \"–£ –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è\"\n‚Ä¢ \"–≠—Ç–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –º–µ–Ω—è\"\n‚Ä¢ \"–Ø –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é –Ω–∞ –ø–æ—Ç–æ–º\"\n‚Ä¢ \"–ú–Ω–µ –Ω–µ –≤–µ–∑–µ—Ç –≤ –¥–µ–ª–∞—Ö\"\n‚Ä¢ \"–Ø –Ω–µ —É–º–µ—é –¥–æ–≤–æ–¥–∏—Ç—å –¥–æ –∫–æ–Ω—Ü–∞\"\n\nüí° *–ó–Ω–∞–∫–æ–º–æ? –¢–µ–ø–µ—Ä—å –æ–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏!*"
      reply_markup:
        inline_keyboard:
          - - text: "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã"
              callback_data: "write_ya_delo_viruses"
    next_step: wait_write_ya_delo

  - id: wait_write_ya_delo
    type: input
    params:
      input_type: "callback_query"
      expected_callbacks: ["write_ya_delo_viruses"]
      timeout: 3600
    next_step: ask_ya_delo_response

  - id: ask_ya_delo_response
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "‚úçÔ∏è **–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –º—ã—Å–ª–µ–≤–∏—Ä—É—Å—ã –≤ —Å—Ñ–µ—Ä–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**\n\n–ù–∞–ø—Ä–∏–º–µ—Ä:\n‚Ä¢ –ß—Ç–æ –º–µ—à–∞–µ—Ç –≤–∞–º –≤ —Ä–∞–±–æ—Ç–µ/–±–∏–∑–Ω–µ—Å–µ?\n‚Ä¢ –ö–∞–∫–∏–µ —Å—Ç—Ä–∞—Ö–∏ –µ—Å—Ç—å –ø–æ –ø–æ–≤–æ–¥—É –¥–µ–π—Å—Ç–≤–∏–π?\n‚Ä¢ –û—Ç —á–µ–≥–æ –≤—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ –∏–ª–∏ –∏–∑–±–µ–≥–∞–µ—Ç–µ?\n\n*–ë—É–¥—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–ø –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.*"
    next_step: wait_ya_delo_response

  - id: wait_ya_delo_response
    type: input
    params:
      input_type: "text"
      timeout: 3600
    next_step: save_ya_delo_response

  - id: save_ya_delo_response
    type: mongo_upsert_document
    params:
      collection: "ontobot_responses"
      filter:
        user_id: "{user_id}"
        bot_name: "mr_ontobot"
      document:
        user_id: "{user_id}"
        bot_name: "mr_ontobot"
        ya_delo_response: "{user_input}"
        telegram_username: "{telegram_username}"
        telegram_first_name: "{telegram_first_name}"
        updated_at: "{current_datetime}"
      output_var: "save_response_result"
    next_step: switch_to_ya_relations

  - id: switch_to_ya_relations
    type: switch_scenario
    params:
      scenario_id: "mr_ontobot_diagnostic_ya_relations"
      context_merge: true
    next_step: end

  - id: end
    type: end
    params:
      message: "–≠—Ç–∞–ø –Ø-–î–µ–ª–æ –∑–∞–≤–µ—Ä—à–µ–Ω" 