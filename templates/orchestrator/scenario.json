{
  "scenario_id": "template_orchestrator",
  "name": "–®–∞–±–ª–æ–Ω: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤",
  "description": "–ì–ª–∞–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥—Ä—É–≥–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö",
  "version": "1.0",
  "initial_context": {
    "orchestration_mode": "sequential",
    "available_scenarios": [
      "template_user_registration",
      "template_llm_chat", 
      "template_faq_rag",
      "template_llm_multi_step"
    ],
    "max_parallel_scenarios": 3,
    "timeout_seconds": 1800
  },
  "steps": [
    {
      "id": "start",
      "type": "start",
      "params": {},
      "next_step": "welcome_orchestrator"
    },
    {
      "id": "welcome_orchestrator",
      "type": "message",
      "params": {
        "text": "üé≠ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤!**\n\n–Ø –º–æ–≥—É —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö:\n\n1Ô∏è‚É£ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º\n2Ô∏è‚É£ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ\n3Ô∏è‚É£ **–£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ —É—Å–ª–æ–≤–∏—è–º\n4Ô∏è‚É£ **–ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üí —á–∞—Ç ‚Üí FAQ"
      },
      "next_step": "get_orchestration_mode"
    },
    {
      "id": "get_orchestration_mode",
      "type": "input",
      "params": {
        "prompt": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (1-4):",
        "input_type": "text",
        "output_var": "mode_choice"
      },
      "next_step": "determine_mode"
    },
    {
      "id": "determine_mode",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('mode_choice') == '1'",
            "next_step": "sequential_mode"
          },
          {
            "condition": "context.get('mode_choice') == '2'",
            "next_step": "parallel_mode"
          },
          {
            "condition": "context.get('mode_choice') == '3'",
            "next_step": "conditional_mode"
          },
          {
            "condition": "context.get('mode_choice') == '4'",
            "next_step": "workflow_mode"
          }
        ],
        "default_next_step": "invalid_mode_choice"
      }
    },
    {
      "id": "invalid_mode_choice",
      "type": "message",
      "params": {
        "text": "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 4."
      },
      "next_step": "get_orchestration_mode"
    },
    {
      "id": "sequential_mode",
      "type": "message",
      "params": {
        "text": "üìã **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º**\n\n–í—ã–ø–æ–ª–Ω—é —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –Ω–∏–º–∏."
      },
      "next_step": "run_sequential_scenarios"
    },
    {
      "id": "run_sequential_scenarios",
      "type": "execute_scenarios_sequence",
      "params": {
        "scenarios": [
          {
            "scenario_id": "template_user_registration",
            "input_context": {
              "greeting": "–ù–∞—á–∏–Ω–∞–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
            }
          },
          {
            "scenario_id": "template_llm_chat",
            "input_context": {
              "bot_name": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç",
              "user_email": "{user_email}"
            }
          }
        ],
        "stop_on_error": true,
        "pass_context": true,
        "output_var": "sequential_results"
      },
      "next_step": "show_sequential_results"
    },
    {
      "id": "show_sequential_results",
      "type": "message",
      "params": {
        "text": "‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**\n\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n{sequential_results}\n\n–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞."
      },
      "next_step": "ask_continue"
    },
    {
      "id": "parallel_mode",
      "type": "message",
      "params": {
        "text": "‚ö° **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º**\n\n–ó–∞–ø—É—â—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ."
      },
      "next_step": "run_parallel_scenarios"
    },
    {
      "id": "run_parallel_scenarios",
      "type": "execute_scenarios_parallel",
      "params": {
        "scenarios": [
          {
            "scenario_id": "template_faq_rag",
            "input_context": {
              "knowledge_base": "general_faq",
              "greeting": "FAQ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ"
            }
          },
          {
            "scenario_id": "template_llm_multi_step",
            "input_context": {
              "process_type": "analysis",
              "user_email": "demo@example.com"
            }
          }
        ],
        "timeout_seconds": "{timeout_seconds}",
        "wait_for_all": true,
        "output_var": "parallel_results"
      },
      "next_step": "show_parallel_results"
    },
    {
      "id": "show_parallel_results",
      "type": "message",
      "params": {
        "text": "‚ö° **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**\n\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n{parallel_results}\n\n–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ."
      },
      "next_step": "ask_continue"
    },
    {
      "id": "conditional_mode",
      "type": "input",
      "params": {
        "prompt": "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å (beginner/advanced):",
        "input_type": "text",
        "output_var": "user_level"
      },
      "next_step": "run_conditional_scenarios"
    },
    {
      "id": "run_conditional_scenarios",
      "type": "conditional_execute",
      "params": {
        "conditions": [
          {
            "condition": "context.get('user_level') == 'beginner'",
            "scenario_id": "template_user_registration",
            "input_context": {
              "greeting": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –Ω–æ–≤–∏—á–æ–∫! –ù–∞—á–Ω—ë–º —Å –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏."
            }
          },
          {
            "condition": "context.get('user_level') == 'advanced'", 
            "scenario_id": "template_llm_multi_step",
            "input_context": {
              "process_type": "advanced_analysis",
              "user_email": "advanced@example.com"
            }
          }
        ],
        "default_scenario": {
          "scenario_id": "template_llm_chat",
          "input_context": {
            "bot_name": "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ü–æ–º–æ—â–Ω–∏–∫"
          }
        },
        "output_var": "conditional_result"
      },
      "next_step": "show_conditional_results"
    },
    {
      "id": "show_conditional_results",
      "type": "message",
      "params": {
        "text": "üéØ **–£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**\n\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:\n{conditional_result}\n\n–°—Ü–µ–Ω–∞—Ä–∏–π –≤—ã–±—Ä–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è: {user_level}"
      },
      "next_step": "ask_continue"
    },
    {
      "id": "workflow_mode",
      "type": "message",
      "params": {
        "text": "üîÑ **–ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å**\n\n–ó–∞–ø—É—Å–∫–∞—é –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:\n1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n2. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç\n3. FAQ –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n\n–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç..."
      },
      "next_step": "workflow_step1_registration"
    },
    {
      "id": "workflow_step1_registration", 
      "type": "execute_scenario",
      "params": {
        "scenario_id": "template_user_registration",
        "input_context": {
          "greeting": "üîÑ –®–∞–≥ 1/3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"
        },
        "timeout_seconds": 600,
        "output_var": "registration_result",
        "output_mapping": {
          "registered_user_email": "user_email",
          "registered_user_name": "user_name"
        }
      },
      "next_step": "workflow_step2_chat"
    },
    {
      "id": "workflow_step2_chat",
      "type": "execute_scenario",
      "params": {
        "scenario_id": "template_llm_chat",
        "input_context": {
          "bot_name": "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç",
          "user_email": "{registered_user_email}",
          "greeting": "üîÑ –®–∞–≥ 2/3: –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–æ–±—â–∞–µ–º—Å—è! –Ø –∑–Ω–∞—é –æ –≤–∞—Å: {registered_user_name}"
        },
        "timeout_seconds": 600,
        "output_var": "chat_result"
      },
      "next_step": "workflow_step3_faq"
    },
    {
      "id": "workflow_step3_faq",
      "type": "execute_scenario",
      "params": {
        "scenario_id": "template_faq_rag",
        "input_context": {
          "knowledge_base": "workflow_faq",
          "greeting": "üîÑ –®–∞–≥ 3/3: FAQ –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –£ –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å–∞?"
        },
        "timeout_seconds": 600,
        "output_var": "faq_result"
      },
      "next_step": "workflow_complete"
    },
    {
      "id": "workflow_complete",
      "type": "message",
      "params": {
        "text": "üéâ **–ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à—ë–Ω!**\n\n‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã:**\n1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {registration_result.status}\n2. ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —á–∞—Ç: {chat_result.status}\n3. ‚úÖ FAQ –ø–æ–¥–¥–µ—Ä–∂–∫–∞: {faq_result.status}\n\nüìã **–°–≤–æ–¥–∫–∞:**\n‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {registered_user_name}\n‚Ä¢ Email: {registered_user_email}\n‚Ä¢ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ\n\nüöÄ –í—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã!"
      },
      "next_step": "save_workflow_results"
    },
    {
      "id": "save_workflow_results",
      "type": "mongo_insert_one",
      "params": {
        "collection": "orchestrator_workflows",
        "document": {
          "workflow_type": "full_process",
          "user_email": "{registered_user_email}",
          "user_name": "{registered_user_name}",
          "steps_completed": 3,
          "registration_result": "{registration_result}",
          "chat_result": "{chat_result}",
          "faq_result": "{faq_result}",
          "completion_time": "{current_timestamp}",
          "status": "completed"
        },
        "output_var": "workflow_saved"
      },
      "next_step": "ask_continue"
    },
    {
      "id": "ask_continue",
      "type": "input",
      "params": {
        "prompt": "–•–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω —Ä–µ–∂–∏–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏? (–¥–∞/–Ω–µ—Ç)",
        "input_type": "text",
        "output_var": "continue_orchestration"
      },
      "next_step": "check_continue"
    },
    {
      "id": "check_continue",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('continue_orchestration', '').lower().strip() in ['–¥–∞', 'yes', 'y', '–∫–æ–Ω–µ—á–Ω–æ']",
            "next_step": "get_orchestration_mode"
          }
        ],
        "default_next_step": "orchestrator_farewell"
      }
    },
    {
      "id": "orchestrator_farewell",
      "type": "message",
      "params": {
        "text": "üé≠ **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É**\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏!\n\nüìä **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏–∑—É—á–∏–ª–∏:**\n‚Ä¢ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤\n‚Ä¢ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã\n‚Ä¢ –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞\n‚Ä¢ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã\n\nüöÄ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã!"
      },
      "next_step": "log_orchestrator_session"
    },
    {
      "id": "log_orchestrator_session",
      "type": "log",
      "params": {
        "message": "Orchestrator session completed. Mode used: {mode_choice}",
        "level": "INFO"
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end",
      "params": {}
    }
  ]
} 