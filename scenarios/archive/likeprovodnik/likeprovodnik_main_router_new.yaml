scenario_id: likeprovodnik_main_router_new
description: "–õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫ - –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä v3.0 —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏ LLM –¥–∏–∞–ª–æ–≥–æ–º"
version: "3.0"

initial_context:
  system_name: "–õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫"
  version: "3.0"

steps:
  - id: start
    type: start
    next_step: welcome_back

  - id: welcome_back
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéØ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫!**
        
        –†–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è —Å–Ω–æ–≤–∞! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –≤ –º–∏—Ä–µ –ò–ò –∏ –±–∏–∑–Ω–µ—Å–∞.
        
        üí¨ **–ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?** –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –∏–∑ –º–æ–¥—É–ª–µ–π –Ω–∏–∂–µ:
      parse_mode: HTML
    next_step: show_main_menu

  - id: show_main_menu
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: |
        üß≠ **–í—ã–±–µ—Ä–∏ –º–æ–¥—É–ª—å –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫–∞:**
        
        –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á –≤ —Ç–≤–æ–µ–º –æ–±—É—á–µ–Ω–∏–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏–∏.
      buttons:
        - - text: "üéØ AI-–ü—É—Ç—å"
            callback_data: "module_ai_path"
          - text: "üí° –õ–∞–π—Ñ—Ö–∞–∫–∏"
            callback_data: "module_lifehacks"
        - - text: "üë®‚Äçüè´ AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫"
            callback_data: "module_mentor"
          - text: "üß† –ù–µ–π—Ä–æ–≠–∫—Å–ø–µ—Ä—Ç"
            callback_data: "module_expert"
        - - text: "üßò AI-–ö–æ—É—á"
            callback_data: "module_coach"
          - text: "üì∞ i–î–∞–π–¥–∂–µ—Å—Ç"
            callback_data: "module_digest"
        - - text: "‚ùì –ß—Ç–æ —É–º–µ–µ—Ç –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å?"
            callback_data: "explain_modules"
    next_step: handle_menu_choice

  - id: handle_menu_choice
    type: input
    params:
      waiting_for: callback_query
      timeout_seconds: 300
      timeout_step: show_main_menu
    next_step: process_choice

  - id: process_choice
    type: branch
    params:
      conditions:
        - condition: "context.callback_data == 'module_ai_path'"
          next_step: go_to_ai_path
        - condition: "context.callback_data == 'module_lifehacks'"
          next_step: go_to_lifehacks
        - condition: "context.callback_data == 'module_mentor'"
          next_step: go_to_mentor
        - condition: "context.callback_data == 'module_expert'"
          next_step: go_to_expert
        - condition: "context.callback_data == 'module_coach'"
          next_step: go_to_coach
        - condition: "context.callback_data == 'module_digest'"
          next_step: go_to_digest
        - condition: "context.callback_data == 'explain_modules'"
          next_step: explain_modules
      default_next_step: handle_text_input

  - id: explain_modules
    type: llm_query
    params:
      provider: "anthropic"
      model: "claude-3-haiku-20240307"
      prompt: |
        –¢—ã - –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫, AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –≤ –±–∏–∑–Ω–µ—Å–µ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö.
        
        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ç–≤–æ–∏—Ö –º–æ–¥—É–ª—è—Ö. –û–±—ä—è—Å–Ω–∏ –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —É–º–µ–µ—Ç –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å:
        
        üéØ AI-–ü—É—Ç—å - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è
        üí° –õ–∞–π—Ñ—Ö–∞–∫–∏ - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-—Å–æ–≤–µ—Ç–æ–≤ —Å –ò–ò  
        üë®‚Äçüè´ AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ - –ø–æ–º–æ—â—å —Å –∫—É—Ä—Å–∞–º–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏
        üß† –ù–µ–π—Ä–æ–≠–∫—Å–ø–µ—Ä—Ç - –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
        üßò AI-–ö–æ—É—á - –º–æ—Ç–∏–≤–∞—Ü–∏—è, —Ü–µ–ª–∏ –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏—è
        üì∞ i–î–∞–π–¥–∂–µ—Å—Ç - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –ò–ò
        
        –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_niche}, –¥–æ—Ö–æ–¥: {user_income_a}-{user_income_b}, –≤—Ä–µ–º—è: {user_time}
        
        –ù–∞–ø–∏—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –º–æ–¥—É–ª—å), –∫–∞–∫–æ–π –º–æ–¥—É–ª—å –¥–ª—è —á–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –≠–¢–û–ú–£ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
        
        –°—Ç–∏–ª—å: –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏.
      output_var: modules_explanation
    next_step: send_explanation

  - id: send_explanation
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: "{modules_explanation}"
      parse_mode: HTML
    next_step: show_main_menu

  - id: handle_text_input
    type: llm_query
    params:
      provider: "anthropic"
      model: "claude-3-haiku-20240307"
      prompt: |
        –¢—ã - –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫, AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –≤ –±–∏–∑–Ω–µ—Å–µ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö.
        
        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª: "{message_text}"
        
        –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 
        - –ù–∏—à–∞: {user_niche}
        - –î–æ—Ö–æ–¥: {user_income_a}-{user_income_b}
        - –í—Ä–µ–º—è: {user_time}
        - –£—Ä–æ–≤–µ–Ω—å IT: {user_it_level}
        
        –ú–æ–¥—É–ª–∏ –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫–∞:
        üéØ AI-–ü—É—Ç—å - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è
        üí° –õ–∞–π—Ñ—Ö–∞–∫–∏ - –±–∏–∑–Ω–µ—Å-—Å–æ–≤–µ—Ç—ã —Å –ò–ò
        üë®‚Äçüè´ AI-–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ - –ø–æ–º–æ—â—å —Å –∫—É—Ä—Å–∞–º–∏
        üß† –ù–µ–π—Ä–æ–≠–∫—Å–ø–µ—Ä—Ç - —Ä–µ—à–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
        üßò AI-–ö–æ—É—á - –º–æ—Ç–∏–≤–∞—Ü–∏—è –∏ —Ü–µ–ª–∏
        üì∞ i–î–∞–π–¥–∂–µ—Å—Ç - –Ω–æ–≤–æ—Å—Ç–∏ –ò–ò
        
        –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–æ–π –º–æ–¥—É–ª—å –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        –û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
        –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: [–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–æ–¥—É–ª—è]
        –û–ë–™–Ø–°–ù–ï–ù–ò–ï: [1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ—á–µ–º—É —ç—Ç–æ—Ç –º–æ–¥—É–ª—å –ø–æ–¥—Ö–æ–¥–∏—Ç]
        
        –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ—è—Å–Ω—ã–π, –ø—Ä–µ–¥–ª–æ–∂–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é.
      output_var: recommendation
    next_step: send_recommendation

  - id: send_recommendation
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ü§ñ **–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å...**
        
        {recommendation}
        
        üí° –•–æ—á–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–º—É –º–æ–¥—É–ª—é –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π?
      parse_mode: HTML
    next_step: show_main_menu

  # –ü–µ—Ä–µ—Ö–æ–¥—ã –∫ –º–æ–¥—É–ª—è–º
  - id: go_to_ai_path
    type: switch_scenario
    params:
      scenario_id: ai_path_onboarding_flow_v2
      preserve_context: true
    next_step: end

  - id: go_to_lifehacks
    type: switch_scenario
    params:
      scenario_id: lifehack_generator_flow_v3
      preserve_context: true
    next_step: end

  - id: go_to_mentor
    type: switch_scenario
    params:
      scenario_id: ai_mentor_flow_v2
      preserve_context: true
    next_step: end

  - id: go_to_expert
    type: switch_scenario
    params:
      scenario_id: neuroexpert_flow_v2
      preserve_context: true
    next_step: end

  - id: go_to_coach
    type: switch_scenario
    params:
      scenario_id: ai_coach_flow_v2
      preserve_context: true
    next_step: end

  - id: go_to_digest
    type: switch_scenario
    params:
      scenario_id: idigest_flow_v2
      preserve_context: true
    next_step: end

  - id: end
    type: end 