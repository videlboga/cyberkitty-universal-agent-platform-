{
  "scenario_id": "template_llm_multi_step",
  "name": "–®–∞–±–ª–æ–Ω: –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π LLM –ø—Ä–æ—Ü–µ—Å—Å",
  "description": "–°–ª–æ–∂–Ω—ã–π LLM —Å—Ü–µ–Ω–∞—Ä–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏, –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ",
  "version": "1.0",
  "initial_context": {
    "process_type": "creative_writing",
    "user_collection": "users",
    "models": {
      "fast": "gpt-3.5-turbo",
      "smart": "gpt-4",
      "creative": "claude-3-sonnet",
      "coding": "deepseek/deepseek-coder"
    },
    "max_tokens": 300,
    "temperature_creative": 0.9,
    "temperature_analytical": 0.3
  },
  "steps": [
    {
      "id": "start",
      "type": "start",
      "params": {},
      "next_step": "get_user_info"
    },
    {
      "id": "get_user_info",
      "type": "input",
      "params": {
        "prompt": "–£–∫–∞–∂–∏—Ç–µ –≤–∞—à email –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞:",
        "input_type": "text",
        "output_var": "user_email"
      },
      "next_step": "find_user"
    },
    {
      "id": "find_user",
      "type": "mongo_find_one",
      "params": {
        "collection": "{user_collection}",
        "filter": {
          "email": "{user_email}"
        },
        "output_var": "user_data"
      },
      "next_step": "get_topic"
    },
    {
      "id": "get_topic",
      "type": "input",
      "params": {
        "prompt": "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ—Ü–µ—Å—Å–∞:\n1. –¢–≤–æ—Ä—á–µ—Å–∫–æ–µ –ø–∏—Å–∞–Ω–∏–µ\n2. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö\n3. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ\n4. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-4):",
        "input_type": "text",
        "output_var": "process_choice"
      },
      "next_step": "determine_process"
    },
    {
      "id": "determine_process",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('process_choice') == '1'",
            "next_step": "creative_step1_idea"
          },
          {
            "condition": "context.get('process_choice') == '2'",
            "next_step": "analysis_step1_data"
          },
          {
            "condition": "context.get('process_choice') == '3'",
            "next_step": "coding_step1_requirements"
          },
          {
            "condition": "context.get('process_choice') == '4'",
            "next_step": "planning_step1_scope"
          }
        ],
        "default_next_step": "invalid_choice"
      }
    },
    {
      "id": "invalid_choice",
      "type": "message",
      "params": {
        "text": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 4."
      },
      "next_step": "get_topic"
    },
    {
      "id": "creative_step1_idea",
      "type": "input",
      "params": {
        "prompt": "–û–ø–∏—à–∏—Ç–µ —Ç–µ–º—É –∏–ª–∏ –∏–¥–µ—é –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:",
        "input_type": "text",
        "output_var": "creative_topic"
      },
      "next_step": "creative_step2_generate"
    },
    {
      "id": "creative_step2_generate",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –ø–∏—Å–∞—Ç–µ–ª—å. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_data.name} –∏–∑ –≥–æ—Ä–æ–¥–∞ {user_data.city}.\n\n–¢–µ–º–∞: {creative_topic}\n\n–ù–∞–ø–∏—à–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ —ç—Ç—É —Ç–µ–º—É. –£—á—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.",
        "model": "{models.creative}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_creative}",
        "output_var": "creative_draft"
      },
      "next_step": "creative_step3_improve"
    },
    {
      "id": "creative_step3_improve",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä-–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª. –£–ª—É—á—à–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç:\n\n{creative_draft}\n\n–°–¥–µ–ª–∞–π –µ–≥–æ –±–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–º, –ø—Ä–æ–≤–µ—Ä—å —Å—Ç–∏–ª—å –∏ –≥—Ä–∞–º–º–∞—Ç–∏–∫—É. –°–æ—Ö—Ä–∞–Ω–∏ –æ—Å–Ω–æ–≤–Ω—É—é –∏–¥–µ—é, –Ω–æ —Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.",
        "model": "{models.smart}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "creative_final"
      },
      "next_step": "show_final_result"
    },
    {
      "id": "analysis_step1_data",
      "type": "input",
      "params": {
        "prompt": "–û–ø–∏—à–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:",
        "input_type": "text",
        "output_var": "analysis_data"
      },
      "next_step": "analysis_step2_structure"
    },
    {
      "id": "analysis_step2_structure",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã –∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_data.name} –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –¥–∞–Ω–Ω—ã–µ:\n\n{analysis_data}\n\n–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∞–Ω–∞–ª–∏–∑–∞:\n1. –û–ø—Ä–µ–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n2. –ü—Ä–µ–¥–ª–æ–∂–∏ –º–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞\n3. –û–ø—Ä–µ–¥–µ–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ\n4. –û–ø–∏—à–∏ –æ–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã",
        "model": "{models.smart}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "analysis_plan"
      },
      "next_step": "analysis_step3_insights"
    },
    {
      "id": "analysis_step3_insights",
      "type": "llm_request",
      "params": {
        "prompt": "–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –ø–ª–∞–Ω–µ –∞–Ω–∞–ª–∏–∑–∞:\n\n{analysis_plan}\n\n–ò –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:\n{analysis_data}\n\n–ü—Ä–æ–≤–µ–¥–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –≤—ã–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã. –ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.",
        "model": "{models.smart}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "analysis_insights"
      },
      "next_step": "show_final_result"
    },
    {
      "id": "coding_step1_requirements",
      "type": "input",
      "params": {
        "prompt": "–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:",
        "input_type": "text",
        "output_var": "coding_task"
      },
      "next_step": "coding_step2_architecture"
    },
    {
      "id": "coding_step2_architecture",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –ó–∞–¥–∞—á–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_data.name}:\n\n{coding_task}\n\n–°–æ–∑–¥–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:\n1. –í—ã–±–µ—Ä–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\n2. –û–ø–∏—à–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–¥–∞\n3. –û–ø—Ä–µ–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n4. –ü—Ä–µ–¥–ª–æ–∂–∏ –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏",
        "model": "{models.coding}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "coding_architecture"
      },
      "next_step": "coding_step3_implementation"
    },
    {
      "id": "coding_step3_implementation",
      "type": "llm_request",
      "params": {
        "prompt": "–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:\n\n{coding_architecture}\n\n–ò —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö:\n{coding_task}\n\n–ù–∞–ø–∏—à–∏ —Ä–∞–±–æ—á–∏–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏. –í–∫–ª—é—á–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.",
        "model": "{models.coding}",
        "max_tokens": 500,
        "temperature": 0.1,
        "output_var": "coding_implementation"
      },
      "next_step": "show_final_result"
    },
    {
      "id": "planning_step1_scope",
      "type": "input",
      "params": {
        "prompt": "–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å:",
        "input_type": "text",
        "output_var": "project_description"
      },
      "next_step": "planning_step2_breakdown"
    },
    {
      "id": "planning_step2_breakdown",
      "type": "llm_request",
      "params": {
        "prompt": "–¢—ã project manager. –ü—Ä–æ–µ–∫—Ç –æ—Ç {user_data.name}:\n\n{project_description}\n\n–°–æ–∑–¥–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω:\n1. –†–∞–∑–±–µ–π –Ω–∞ —ç—Ç–∞–ø—ã\n2. –û–ø—Ä–µ–¥–µ–ª–∏ —Ä–µ—Å—É—Ä—Å—ã\n3. –û—Ü–µ–Ω–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏\n4. –í—ã—è–≤–∏ —Ä–∏—Å–∫–∏",
        "model": "{models.smart}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "project_plan"
      },
      "next_step": "planning_step3_timeline"
    },
    {
      "id": "planning_step3_timeline",
      "type": "llm_request",
      "params": {
        "prompt": "–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–ª–∞–Ω–∞:\n\n{project_plan}\n\n–ò –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:\n{project_description}\n\n–°–æ–∑–¥–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π timeline —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏, –º–∏–ª–µ—Å—Ç–æ—É–Ω–∞–º–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏.",
        "model": "{models.fast}",
        "max_tokens": "{max_tokens}",
        "temperature": "{temperature_analytical}",
        "output_var": "project_timeline"
      },
      "next_step": "show_final_result"
    },
    {
      "id": "show_final_result",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('process_choice') == '1'",
            "next_step": "show_creative_result"
          },
          {
            "condition": "context.get('process_choice') == '2'",
            "next_step": "show_analysis_result"
          },
          {
            "condition": "context.get('process_choice') == '3'",
            "next_step": "show_coding_result"
          },
          {
            "condition": "context.get('process_choice') == '4'",
            "next_step": "show_planning_result"
          }
        ],
        "default_next_step": "end"
      }
    },
    {
      "id": "show_creative_result",
      "type": "message",
      "params": {
        "text": "üé® **–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à—ë–Ω!**\n\n**–¢–µ–º–∞:** {creative_topic}\n\n**–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç:**\n{creative_final}\n\n---\n*–ü—Ä–æ—Ü–µ—Å—Å –≤–∫–ª—é—á–∞–ª –¥–≤–∞ —ç—Ç–∞–ø–∞: –∫—Ä–µ–∞—Ç–∏–≤–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ*"
      },
      "next_step": "save_result"
    },
    {
      "id": "show_analysis_result",
      "type": "message",
      "params": {
        "text": "üìä **–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à—ë–Ω!**\n\n**–ü–ª–∞–Ω –∞–Ω–∞–ª–∏–∑–∞:**\n{analysis_plan}\n\n**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã:**\n{analysis_insights}\n\n---\n*–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≤–µ–¥—ë–Ω –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã—è–≤–ª–µ–Ω–∏–µ –∏–Ω—Å–∞–π—Ç–æ–≤*"
      },
      "next_step": "save_result"
    },
    {
      "id": "show_coding_result",
      "type": "message",
      "params": {
        "text": "üíª **–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**\n\n**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**\n{coding_architecture}\n\n**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**\n{coding_implementation}\n\n---\n*–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–ª–∞—Å—å –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞: –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞*"
      },
      "next_step": "save_result"
    },
    {
      "id": "show_planning_result",
      "type": "message",
      "params": {
        "text": "üìã **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!**\n\n**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω:**\n{project_plan}\n\n**Timeline:**\n{project_timeline}\n\n---\n*–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞–Ω–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ timeline*"
      },
      "next_step": "save_result"
    },
    {
      "id": "save_result",
      "type": "mongo_insert_one",
      "params": {
        "collection": "multi_step_results",
        "document": {
          "user_email": "{user_email}",
          "user_name": "{user_data.name}",
          "process_type": "{process_choice}",
          "final_result": "{creative_final}{analysis_insights}{coding_implementation}{project_timeline}",
          "all_steps": {
            "creative_draft": "{creative_draft}",
            "creative_final": "{creative_final}",
            "analysis_plan": "{analysis_plan}",
            "analysis_insights": "{analysis_insights}",
            "coding_architecture": "{coding_architecture}",
            "coding_implementation": "{coding_implementation}",
            "project_plan": "{project_plan}",
            "project_timeline": "{project_timeline}"
          },
          "models_used": "{models}",
          "timestamp": "{current_timestamp}"
        },
        "output_var": "save_result"
      },
      "next_step": "final_message"
    },
    {
      "id": "final_message",
      "type": "message",
      "params": {
        "text": "‚úÖ –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!\n\n–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.\nID –∑–∞–ø–∏—Å–∏: {save_result}\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞!"
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end",
      "params": {}
    }
  ]
} 