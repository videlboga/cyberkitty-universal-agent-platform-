scenario_id: likeprovodnik_main_router_v2
description: "–õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫ - –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä v2.0 (–∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ Universal Agent Platform)"
version: "2.0"

initial_context:
  system_name: "–õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫ v2.0"
  platform: "Universal Agent Platform"

steps:
  - id: start
    type: start
    next_step: welcome_message

  - id: welcome_message
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ü§ñ **–ü—Ä–∏–≤–µ—Ç! –Ø –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫** ‚Äî —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ –±–∏–∑–Ω–µ—Å–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π!

        ‚ú® **–ß—Ç–æ —è —É–º–µ—é:**
        üéØ **AI-–ü—É—Ç—å** ‚Äî —Å–æ–∑–¥–∞—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è
        üí° **–õ–∞–π—Ñ—Ö–∞–∫–∏** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É—é –±–∏–∑–Ω–µ—Å-—Å–æ–≤–µ—Ç—ã —Å –ò–ò
        üë®‚Äçüè´ **–ù–∞—Å—Ç–∞–≤–Ω–∏–∫** ‚Äî –æ—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫—É—Ä—Å–∞–º
        üß† **–ù–µ–π—Ä–æ–≠–∫—Å–ø–µ—Ä—Ç** ‚Äî —Ä–µ—à–∞—é —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ—à–∞–≥–æ–≤–æ
        üßò **AI-–ö–æ—É—á** ‚Äî –ø–æ–º–æ–≥–∞—é —Å –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π
        üì∞ **i–î–∞–π–¥–∂–µ—Å—Ç** ‚Äî –Ω–æ–≤–æ—Å—Ç–∏ –ò–ò –∑–∞ –Ω–µ–¥–µ–ª—é

        üí¨ **–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!**
      parse_mode: HTML
    next_step: load_user_profile

  - id: load_user_profile
    type: mongo_find_one_document
    params:
      collection: users
      filter:
        user_id: "{user_id}"
      output_var: user_profile
    next_step: check_new_user

  - id: check_new_user
    type: branch
    params:
      conditions:
        - condition: "not context.get('user_profile') or context.get('user_profile', {}).get('onboarding_completed', False) == False"
          next_scenario: ai_path_onboarding_flow_v2
      default_next_step: detect_intent

  - id: detect_intent
    type: branch
    params:
      conditions:
        - condition: "'–ª–∞–π—Ñ—Ö–∞–∫' in context.get('message_text', '').lower() or '—Å–æ–≤–µ—Ç' in context.get('message_text', '').lower()"
          next_scenario: lifehack_generator_flow_v2
        - condition: "'–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫' in context.get('message_text', '').lower() or '—É—Ä–æ–∫' in context.get('message_text', '').lower() or '–º–∞—Ç–µ—Ä–∏–∞–ª' in context.get('message_text', '').lower() or '–∫—É—Ä—Å' in context.get('message_text', '').lower()"
          next_scenario: ai_mentor_flow_v2
        - condition: "'–∑–∞–¥–∞—á–∞' in context.get('message_text', '').lower() or '—Ä–µ—à–µ–Ω–∏–µ' in context.get('message_text', '').lower() or '—ç–∫—Å–ø–µ—Ä—Ç' in context.get('message_text', '').lower() or '–ø—Ä–æ–±–ª–µ–º–∞' in context.get('message_text', '').lower()"
          next_scenario: neuroexpert_flow_v2
        - condition: "'—Ü–µ–ª—å' in context.get('message_text', '').lower() or '–∫–æ—É—á' in context.get('message_text', '').lower() or '—Ä–µ—Ñ–ª–µ–∫—Å–∏—è' in context.get('message_text', '').lower() or '–º–æ—Ç–∏–≤–∞—Ü–∏—è' in context.get('message_text', '').lower()"
          next_scenario: ai_coach_flow_v2
        - condition: "'–Ω–æ–≤–æ—Å—Ç–∏' in context.get('message_text', '').lower() or '–¥–∞–π–¥–∂–µ—Å—Ç' in context.get('message_text', '').lower() or '–∏–∏' in context.get('message_text', '').lower() or 'ai' in context.get('message_text', '').lower()"
          next_scenario: idigest_flow_v2
        - condition: "'–ø–ª–∞–Ω' in context.get('message_text', '').lower() or '–æ–±—É—á–µ–Ω–∏–µ' in context.get('message_text', '').lower() or '–ø—É—Ç—å' in context.get('message_text', '').lower()"
          next_scenario: ai_path_onboarding_flow_v2
      default_next_step: default_lifehack

  - id: default_lifehack
    type: switch_scenario
    params:
      scenario_id: lifehack_generator_flow_v2
      preserve_context: true
    next_step: end

  - id: end
    type: end 