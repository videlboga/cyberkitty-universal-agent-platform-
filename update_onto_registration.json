{
  "collection": "scenarios",
  "filter": {"scenario_id": "onto_registration"},
  "document": {
    "scenario_id": "onto_registration",
    "name": "ONTO –∫–æ—É—á–∏–Ω–≥ - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
    "description": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ ONTO –∫–æ—É—á–∏–Ω–≥–∞",
    "steps": [
      {
        "id": "start",
        "type": "start",
        "next_step_id": "welcome_message"
      },
      {
        "id": "welcome_message",
        "type": "channel_action",
        "params": {
          "action": "send_message",
          "chat_id": "{chat_id}",
          "text": "üåü –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ONTO –∫–æ—É—á–∏–Ω–≥!\n\nüß† ONTO –∫–æ—É—á–∏–Ω–≥ - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–∞—à–µ–≥–æ —Å–ø–æ—Å–æ–±–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è.\n\nüí° –ú—ã –ø–æ–º–æ–∂–µ–º –≤–∞–º:\n‚Ä¢ –û—Å–æ–∑–Ω–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–µ —É–±–µ–∂–¥–µ–Ω–∏—è\n‚Ä¢ –†–∞—Å—à–∏—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π\n‚Ä¢ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –±—ã—Ç–∏—è\n‚Ä¢ –î–æ—Å—Ç–∏—á—å –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏\n\nüöÄ –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:\n1Ô∏è‚É£ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è\n2Ô∏è‚É£ –ì–ª—É–±–æ–∫–∏–π –æ–ø—Ä–æ—Å –æ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏\n3Ô∏è‚É£ –ò–ò –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–∏\n4Ô∏è‚É£ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–≤–∏—Ç–∏—è\n\nüìù –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!",
          "parse_mode": "HTML"
        },
        "next_step_id": "ask_name"
      },
      {
        "id": "ask_name",
        "type": "channel_action",
        "params": {
          "action": "send_message",
          "chat_id": "{chat_id}",
          "text": "üëã –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?\n\n–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è, –∫–∞–∫ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã, —á—Ç–æ–±—ã —è –∫ –≤–∞–º –æ–±—Ä–∞—â–∞–ª—Å—è.",
          "parse_mode": "HTML"
        },
        "next_step_id": "wait_name"
      },
      {
        "id": "wait_name",
        "type": "input",
        "params": {
          "variable": "user_name",
          "validation": "required"
        },
        "next_step_id": "ask_email"
      },
      {
        "id": "ask_email",
        "type": "channel_action",
        "params": {
          "action": "send_message",
          "chat_id": "{chat_id}",
          "text": "üìß –û—Ç–ª–∏—á–Ω–æ, {user_name}!\n\n–¢–µ–ø–µ—Ä—å —É–∫–∞–∂–∏—Ç–µ –≤–∞—à email –¥–ª—è —Å–≤—è–∑–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã.",
          "parse_mode": "HTML"
        },
        "next_step_id": "wait_email"
      },
      {
        "id": "wait_email",
        "type": "input",
        "params": {
          "variable": "user_email",
          "validation": "email"
        },
        "next_step_id": "save_user"
      },
      {
        "id": "save_user",
        "type": "mongo_upsert_document",
        "params": {
          "collection": "onto_users",
          "filter": {
            "user_id": "{user_id}"
          },
          "document": {
            "user_id": "{user_id}",
            "chat_id": "{chat_id}",
            "name": "{user_name}",
            "email": "{user_email}",
            "stage": "questionnaire",
            "created_at": "{current_datetime}",
            "updated_at": "{current_datetime}"
          },
          "output_var": "save_result"
        },
        "next_step_id": "registration_complete"
      },
      {
        "id": "registration_complete",
        "type": "channel_action",
        "params": {
          "action": "send_message",
          "chat_id": "{chat_id}",
          "text": "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\nüéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É ONTO –∫–æ—É—á–∏–Ω–≥–∞, {user_name}!\n\nüìä –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\nüë§ –ò–º—è: {user_name}\nüìß Email: {user_email}\n\nüîÑ –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: –ì–ª—É–±–æ–∫–∏–π –æ–ø—Ä–æ—Å –æ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö.\n\n‚è±Ô∏è –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤–∞—Å –∫ –æ–ø—Ä–æ—Å—É!",
          "parse_mode": "HTML"
        },
        "next_step_id": "end"
      },
      {
        "id": "end",
        "type": "end"
      }
    ]
  }
} 