#!/usr/bin/env python3
"""
ğŸ” ĞŸĞ ĞĞ¡Ğ¢ĞĞ™ Ğ¢Ğ•Ğ¡Ğ¢ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞĞ“Ğ Ğ’ĞĞ›Ğ˜Ğ”ĞĞ¢ĞĞ Ğ

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ÑˆÑ‚Ñ€Ğ°Ñ„Ğ¾Ğ² Ğ±ĞµĞ· ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²
"""

import os

def detect_fake_reports_simple(content: str, file_path: str, task: str) -> dict:
    """ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¾Ñ€Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº"""
    fake_patterns = [
        'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ°',
        'Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ LLM-Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚Ğ°',
        'Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ¼',
        'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸',
        'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ°'
    ]
    
    fake_indicators_found = []
    for pattern in fake_patterns:
        if pattern in content:
            fake_indicators_found.append(pattern)
    
    if len(fake_indicators_found) >= 2:
        return {
            'is_fake': True,
            'reason': f'Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°: {", ".join(fake_indicators_found[:2])}'
        }
    
    return {'is_fake': False, 'reason': 'ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾'}

def test_validator_logic():
    """Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€Ğ°"""
    print("ğŸ” Ğ¢Ğ•Ğ¡Ğ¢ Ğ›ĞĞ“Ğ˜ĞšĞ˜ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞĞ“Ğ Ğ’ĞĞ›Ğ˜Ğ”ĞĞ¢ĞĞ Ğ")
    print("="*50)
    
    # Ğ¡Ğ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµĞ¼ 4 Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¸Ğ· Ğ½Ğ°ÑˆĞµĞ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°
    files_data = [
        {
            "path": "outputs/report.md",
            "content": "# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹\n\nĞ—Ğ°Ğ´Ğ°Ñ‡Ğ°: ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ° Ğ±Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ 24\n\nĞ—Ğ°Ğ´Ğ°Ñ‡Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ° Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ LLM-Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚Ğ°",
            "ext": ".md"
        },
        {
            "path": "outputs/complexity.md", 
            "content": "# Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹\n\nĞ—Ğ°Ğ´Ğ°Ñ‡Ğ°: ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ° Ğ±Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ 24\n\nĞ—Ğ°Ğ´Ğ°Ñ‡Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ° Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ LLM-Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚Ğ°",
            "ext": ".md"
        },
        {
            "path": "outputs/top10_bitrix24_apps.json",
            "content": '[{"name": "Ğ‘Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ24.CRM", "category": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸", "price": "990 Ñ€ÑƒĞ±/Ğ¼ĞµÑ"}]',
            "ext": ".json"
        },
        {
            "path": "outputs/bitrix24_market_analysis.md",
            "content": "# ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ° Ğ‘Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ24\n## Ğ‘Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ24.CRM (4.2â˜…, 990â‚½/Ğ¼ĞµÑ) - Ğ»Ğ¸Ğ´ĞµÑ€ ÑĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸",
            "ext": ".md"
        }
    ]
    
    task = "ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ° Ğ±Ğ¸Ñ‚Ñ€Ğ¸ĞºÑ 24"
    
    # ĞĞĞ’ĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ Ğ’ĞĞ›Ğ˜Ğ”ĞĞ¢ĞĞ Ğ
    score_bonus = 0.0
    fake_files_count = 0
    total_files_count = len(files_data)
    
    print(f"ğŸ“ ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ {total_files_count} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:")
    
    for file_data in files_data:
        file_path = file_data["path"] 
        content = file_data["content"]
        file_ext = file_data["ext"]
        
        print(f"\nğŸ“„ {file_path}")
        print(f"   ğŸ“ ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚: {content[:60]}...")
        
        # Ğ¡ĞĞĞ§ĞĞ›Ğ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸ - Ğ­Ğ¢Ğ ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢!
        fake_check = detect_fake_reports_simple(content, file_path, task)
        
        if fake_check['is_fake']:
            fake_files_count += 1
            print(f"   ğŸš¨ ĞŸĞĞ”Ğ”Ğ•Ğ›ĞšĞ: {fake_check['reason']}")
            # Ğ–ĞĞ¡Ğ¢ĞšĞ˜Ğ™ Ğ¨Ğ¢Ğ ĞĞ¤ Ğ·Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºÑƒ
            score_bonus -= 0.25  # ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ° = -25%
            print(f"   ğŸ’¸ Ğ¨Ñ‚Ñ€Ğ°Ñ„: -0.25 (Ğ¸Ñ‚Ğ¾Ğ³Ğ¾: {score_bonus:.3f})")
            continue  # ĞĞµ Ğ´Ğ°Ñ‘Ğ¼ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ Ğ·Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹!
        
        # Ğ•ÑĞ»Ğ¸ ĞĞ• Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ° - Ğ´Ğ°Ñ‘Ğ¼ Ğ±Ğ¾Ğ½ÑƒÑÑ‹
        if file_ext == ".json":
            score_bonus += 0.1
            print(f"   âœ… Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ JSON: +0.1 (Ğ¸Ñ‚Ğ¾Ğ³Ğ¾: {score_bonus:.3f})")
        elif file_ext == ".md":
            score_bonus += 0.05
            print(f"   âœ… Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ: +0.05 (Ğ¸Ñ‚Ğ¾Ğ³Ğ¾: {score_bonus:.3f})")
        
        print(f"   âœ… Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾")
    
    # ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ Ğ›ĞĞ“Ğ˜ĞšĞ: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº
    fake_ratio = fake_files_count / total_files_count
    
    print(f"\nğŸ“Š ĞĞĞĞ›Ğ˜Ğ— ĞŸĞĞ”Ğ”Ğ•Ğ›ĞĞš:")
    print(f"   ğŸš¨ ĞŸĞ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº: {fake_files_count}/{total_files_count} = {fake_ratio*100:.1f}%")
    
    if fake_ratio >= 0.5:  # 50%+ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº = ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»
        score_bonus = -0.5
        print(f"   ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ ĞŸĞ ĞĞ’ĞĞ›: {fake_ratio*100:.1f}% Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº! Ğ¨Ñ‚Ñ€Ğ°Ñ„: -0.5")
    elif fake_ratio >= 0.3:  # 30%+ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº = ÑĞµÑ€ÑŒÑ‘Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹
        score_bonus -= 0.2
        print(f"   âš ï¸ Ğ¡Ğ•Ğ Ğ¬ĞĞ—ĞĞ«Ğ• ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ«: {fake_ratio*100:.1f}% Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ¾Ğº! Ğ”Ğ¾Ğ¿.ÑˆÑ‚Ñ€Ğ°Ñ„: -0.2")
    elif fake_ratio > 0:
        print(f"   âš ï¸ ĞĞĞ™Ğ”Ğ•ĞĞ« ĞŸĞĞ”Ğ”Ğ•Ğ›ĞšĞ˜: {fake_ratio*100:.1f}%")
    
    print(f"\nğŸ¯ Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:")
    print(f"   ğŸ“Š Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ: {score_bonus:.3f}")
    
    base_score = 0.7
    final_score = base_score + score_bonus
    print(f"   ğŸ”¹ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ»: {base_score}")
    print(f"   ğŸ”¹ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ»: {final_score:.3f}")
    
    print(f"\nğŸ”„ Ğ¡Ğ ĞĞ’ĞĞ•ĞĞ˜Ğ•:")
    print(f"   ğŸ“Š Ğ”Ğ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯: 0.85 (Ğ›ĞĞ–ĞĞ«Ğ™ Ğ£Ğ¡ĞŸĞ•Ğ¥)")
    print(f"   ğŸ“Š ĞŸĞĞ¡Ğ›Ğ• Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯: {final_score:.2f}")
    
    if final_score < 0.7:
        print(f"   âœ… Ğ£Ğ¡ĞŸĞ•Ğ¥! Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¨Ğ¢Ğ ĞĞ¤Ğ£Ğ•Ğ¢: {final_score:.2f} < 0.7")
        print(f"   ğŸ¯ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½Ğ° ĞºĞ°Ğº ĞŸĞ ĞĞ’ĞĞ› Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ½Ğ° Ğ´Ğ¾Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ")
    else:
        print(f"   âŒ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ! Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€ Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚: {final_score:.2f} >= 0.7")

if __name__ == "__main__":
    test_validator_logic() 