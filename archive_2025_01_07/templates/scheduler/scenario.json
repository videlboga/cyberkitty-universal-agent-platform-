{
  "scenario_id": "template_scheduler",
  "name": "–®–∞–±–ª–æ–Ω: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤",
  "description": "–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–ø—É—Å–∫–∞–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
  "version": "1.0",
  "initial_context": {
    "available_scenarios": [
      "template_user_registration",
      "template_llm_chat",
      "template_faq_rag",
      "template_llm_multi_step"
    ],
    "max_concurrent_tasks": 5,
    "default_timeout": 1800
  },
  "steps": [
    {
      "id": "start",
      "type": "start",
      "params": {},
      "next_step": "welcome_scheduler"
    },
    {
      "id": "welcome_scheduler",
      "type": "message",
      "params": {
        "text": "‚è∞ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤!**\n\n–Ø –º–æ–≥—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:\n\n1Ô∏è‚É£ **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫** - —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è\n2Ô∏è‚É£ **–ó–∞–ø—É—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏** - –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç\n3Ô∏è‚É£ **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—É—Å–∫–∏** - –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏\n4Ô∏è‚É£ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ—Ç–º–µ–Ω–∞\n5Ô∏è‚É£ **–î–µ–º–æ —Ä–µ–∂–∏–º** - –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã"
      },
      "next_step": "get_scheduler_mode"
    },
    {
      "id": "get_scheduler_mode",
      "type": "input",
      "params": {
        "prompt": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (1-5):",
        "input_type": "text",
        "output_var": "scheduler_mode"
      },
      "next_step": "determine_scheduler_mode"
    },
    {
      "id": "determine_scheduler_mode",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('scheduler_mode') == '1'",
            "next_step": "delayed_mode"
          },
          {
            "condition": "context.get('scheduler_mode') == '2'",
            "next_step": "timed_mode"
          },
          {
            "condition": "context.get('scheduler_mode') == '3'",
            "next_step": "periodic_mode"
          },
          {
            "condition": "context.get('scheduler_mode') == '4'",
            "next_step": "management_mode"
          },
          {
            "condition": "context.get('scheduler_mode') == '5'",
            "next_step": "demo_mode"
          }
        ],
        "default_next_step": "invalid_scheduler_choice"
      }
    },
    {
      "id": "invalid_scheduler_choice",
      "type": "message",
      "params": {
        "text": "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5."
      },
      "next_step": "get_scheduler_mode"
    },
    {
      "id": "delayed_mode",
      "type": "message",
      "params": {
        "text": "‚è≥ **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫**\n\n–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è."
      },
      "next_step": "get_delay_scenario"
    },
    {
      "id": "get_delay_scenario",
      "type": "input",
      "params": {
        "prompt": "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:\n1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n2. LLM —á–∞—Ç\n3. FAQ RAG\n4. –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π LLM\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:",
        "input_type": "text",
        "output_var": "delay_scenario_choice"
      },
      "next_step": "get_delay_time"
    },
    {
      "id": "get_delay_time",
      "type": "input",
      "params": {
        "prompt": "–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å? (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 5, 10):",
        "input_type": "text",
        "output_var": "delay_minutes"
      },
      "next_step": "schedule_delayed_task"
    },
    {
      "id": "schedule_delayed_task",
      "type": "schedule_delay",
      "params": {
        "scenario_id": "template_llm_chat",
        "delay_minutes": "{delay_minutes}",
        "context": {
          "scheduled_by": "user",
          "delay_mode": true,
          "original_delay": "{delay_minutes} –º–∏–Ω—É—Ç"
        },
        "output_var": "delayed_task_id"
      },
      "next_step": "confirm_delayed_task"
    },
    {
      "id": "confirm_delayed_task",
      "type": "message",
      "params": {
        "text": "‚úÖ **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!**\n\nüìã **–î–µ—Ç–∞–ª–∏:**\n‚Ä¢ –°—Ü–µ–Ω–∞—Ä–∏–π: LLM —á–∞—Ç\n‚Ä¢ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑: {delay_minutes} –º–∏–Ω\n‚Ä¢ ID –∑–∞–¥–∞—á–∏: {delayed_task_id}\n\n‚è∞ –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è."
      },
      "next_step": "ask_scheduler_continue"
    },
    {
      "id": "timed_mode",
      "type": "input",
      "params": {
        "prompt": "–í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DDTHH:MM:SS\n(–Ω–∞–ø—Ä–∏–º–µ—Ä: 2024-12-01T15:30:00):",
        "input_type": "text",
        "output_var": "target_time"
      },
      "next_step": "schedule_timed_task"
    },
    {
      "id": "schedule_timed_task",
      "type": "schedule_at",
      "params": {
        "scenario_id": "template_faq_rag",
        "target_time": "{target_time}",
        "context": {
          "scheduled_by": "user",
          "target_time_mode": true,
          "knowledge_base": "scheduled_faq"
        },
        "output_var": "timed_task_id"
      },
      "next_step": "confirm_timed_task"
    },
    {
      "id": "confirm_timed_task",
      "type": "message",
      "params": {
        "text": "‚úÖ **–ó–∞–ø—É—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!**\n\nüìã **–î–µ—Ç–∞–ª–∏:**\n‚Ä¢ –°—Ü–µ–Ω–∞—Ä–∏–π: FAQ RAG\n‚Ä¢ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: {target_time}\n‚Ä¢ ID –∑–∞–¥–∞—á–∏: {timed_task_id}\n\n‚è∞ –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ—á–Ω–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è."
      },
      "next_step": "ask_scheduler_continue"
    },
    {
      "id": "periodic_mode",
      "type": "input",
      "params": {
        "prompt": "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:\n\n–ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5, 10, 30):",
        "input_type": "text",
        "output_var": "interval_minutes"
      },
      "next_step": "get_max_runs"
    },
    {
      "id": "get_max_runs",
      "type": "input",
      "params": {
        "prompt": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—É—Å–∫–æ–≤ (-1 –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏):",
        "input_type": "text",
        "output_var": "max_runs"
      },
      "next_step": "schedule_periodic_task"
    },
    {
      "id": "schedule_periodic_task",
      "type": "schedule_periodic",
      "params": {
        "scenario_id": "template_llm_multi_step",
        "interval_minutes": "{interval_minutes}",
        "max_runs": "{max_runs}",
        "context": {
          "scheduled_by": "user",
          "periodic_mode": true,
          "process_type": "automated"
        },
        "output_var": "periodic_task_id"
      },
      "next_step": "confirm_periodic_task"
    },
    {
      "id": "confirm_periodic_task",
      "type": "message",
      "params": {
        "text": "‚úÖ **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!**\n\nüìã **–î–µ—Ç–∞–ª–∏:**\n‚Ä¢ –°—Ü–µ–Ω–∞—Ä–∏–π: –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–π LLM\n‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª: –∫–∞–∂–¥—ã–µ {interval_minutes} –º–∏–Ω\n‚Ä¢ –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—É—Å–∫–æ–≤: {max_runs}\n‚Ä¢ ID –∑–∞–¥–∞—á–∏: {periodic_task_id}\n\nüîÑ –°—Ü–µ–Ω–∞—Ä–∏–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
      },
      "next_step": "ask_scheduler_continue"
    },
    {
      "id": "management_mode",
      "type": "message",
      "params": {
        "text": "üõ†Ô∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏**\n\n–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏."
      },
      "next_step": "get_task_to_cancel"
    },
    {
      "id": "get_task_to_cancel",
      "type": "input",
      "params": {
        "prompt": "–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã (–∏–ª–∏ '—Å–ø–∏—Å–æ–∫' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞):",
        "input_type": "text",
        "output_var": "task_id_to_cancel"
      },
      "next_step": "process_task_management"
    },
    {
      "id": "process_task_management",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('task_id_to_cancel', '').lower() == '—Å–ø–∏—Å–æ–∫'",
            "next_step": "show_task_list"
          }
        ],
        "default_next_step": "cancel_task"
      }
    },
    {
      "id": "show_task_list",
      "type": "message",
      "params": {
        "text": "üìã **–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**\n\n‚Ä¢ {delayed_task_id} - –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫\n‚Ä¢ {timed_task_id} - –ó–∞–ø—É—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n‚Ä¢ {periodic_task_id} - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫\n\nüí° –í–≤–µ–¥–∏—Ç–µ ID –¥–ª—è –æ—Ç–º–µ–Ω—ã –∏–ª–∏ '–Ω–∞–∑–∞–¥' –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞."
      },
      "next_step": "get_task_to_cancel"
    },
    {
      "id": "cancel_task",
      "type": "cancel_schedule",
      "params": {
        "task_id": "{task_id_to_cancel}",
        "output_var": "cancellation_result"
      },
      "next_step": "confirm_cancellation"
    },
    {
      "id": "confirm_cancellation",
      "type": "message",
      "params": {
        "text": "üóëÔ∏è **–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–º–µ–Ω—ã:**\n\n–ó–∞–¥–∞—á–∞ {task_id_to_cancel}: {cancellation_result}\n\n‚úÖ –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞, –æ–Ω–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞."
      },
      "next_step": "ask_scheduler_continue"
    },
    {
      "id": "demo_mode",
      "type": "message",
      "params": {
        "text": "üé¨ **–î–µ–º–æ —Ä–µ–∂–∏–º**\n\n–ó–∞–ø—É—Å–∫–∞—é –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è..."
      },
      "next_step": "demo_delayed"
    },
    {
      "id": "demo_delayed",
      "type": "schedule_delay",
      "params": {
        "scenario_id": "template_llm_chat",
        "delay_seconds": 10,
        "context": {
          "demo_mode": true,
          "bot_name": "–î–µ–º–æ –ë–æ—Ç"
        },
        "output_var": "demo_delayed_id"
      },
      "next_step": "demo_periodic"
    },
    {
      "id": "demo_periodic",
      "type": "schedule_periodic",
      "params": {
        "scenario_id": "template_user_registration",
        "interval_minutes": 1,
        "max_runs": 2,
        "context": {
          "demo_mode": true,
          "greeting": "–î–µ–º–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
        },
        "output_var": "demo_periodic_id"
      },
      "next_step": "demo_results"
    },
    {
      "id": "demo_results",
      "type": "message",
      "params": {
        "text": "üé¨ **–î–µ–º–æ –∑–∞–ø—É—â–µ–Ω–æ!**\n\nüìã **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**\n‚Ä¢ –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π (10 —Å–µ–∫): {demo_delayed_id}\n‚Ä¢ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π (1 –º–∏–Ω, 2 —Ä–∞–∑–∞): {demo_periodic_id}\n\n‚è∞ –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤ –ª–æ–≥–∞—Ö —Å–∏—Å—Ç–µ–º—ã."
      },
      "next_step": "ask_scheduler_continue"
    },
    {
      "id": "ask_scheduler_continue",
      "type": "input",
      "params": {
        "prompt": "–•–æ—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫? (–¥–∞/–Ω–µ—Ç)",
        "input_type": "text",
        "output_var": "continue_scheduling"
      },
      "next_step": "check_scheduler_continue"
    },
    {
      "id": "check_scheduler_continue",
      "type": "branch",
      "params": {
        "conditions": [
          {
            "condition": "context.get('continue_scheduling', '').lower().strip() in ['–¥–∞', 'yes', 'y', '–∫–æ–Ω–µ—á–Ω–æ']",
            "next_step": "get_scheduler_mode"
          }
        ],
        "default_next_step": "scheduler_farewell"
      }
    },
    {
      "id": "scheduler_farewell",
      "type": "message",
      "params": {
        "text": "‚è∞ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É**\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!\n\nüìä **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:**\n‚Ä¢ ‚è≥ –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏\n‚Ä¢ üïê –ó–∞–ø—É—Å–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n‚Ä¢ üîÑ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã\n‚Ä¢ üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏\n\nüöÄ –í–∞—à–∏ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!"
      },
      "next_step": "save_scheduler_session"
    },
    {
      "id": "save_scheduler_session",
      "type": "mongo_insert_one",
      "params": {
        "collection": "scheduler_sessions",
        "document": {
          "session_type": "planning",
          "mode_used": "{scheduler_mode}",
          "tasks_created": [
            {
              "type": "delayed",
              "id": "{delayed_task_id}",
              "delay": "{delay_minutes} min"
            },
            {
              "type": "timed",
              "id": "{timed_task_id}",
              "target_time": "{target_time}"
            },
            {
              "type": "periodic",
              "id": "{periodic_task_id}",
              "interval": "{interval_minutes} min"
            }
          ],
          "completion_time": "{current_timestamp}",
          "status": "completed"
        },
        "output_var": "session_saved"
      },
      "next_step": "log_scheduler_session"
    },
    {
      "id": "log_scheduler_session",
      "type": "log",
      "params": {
        "message": "Scheduler session completed. Mode: {scheduler_mode}, Tasks created: {tasks_created}",
        "level": "INFO"
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end",
      "params": {}
    }
  ]
} 