{
  "scenario_id": "ai_path_onboarding_flow",
  "name": "AI-–ü—É—Ç—å - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è",
  "description": "–û–Ω–±–æ—Ä–¥–∏–Ω–≥ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è",
  "version": "1.0",
  
  "steps": [
    {
      "id": "start",
      "type": "start",
      "next_step": "welcome_message"
    },
    {
      "id": "welcome_message",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_message",
        "context_updates": {
          "text": "üéØ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫!</b>\n\n–Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è.\n\n–î–∞–≤–∞–π –ø—Ä–æ–≤–µ–¥–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –æ–ø—Ä–æ—Å, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Ç–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏ —Ü–µ–ª–∏.",
          "parse_mode": "HTML"
        }
      },
      "next_step": "ask_experience"
    },
    {
      "id": "ask_experience",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "üìä <b>–í–æ–ø—Ä–æ—Å 1/5:</b> –ö–∞–∫–æ–π —É —Ç–µ–±—è –æ–ø—ã—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –ò–ò –∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è?",
          "buttons": [
            [{"text": "üî∞ –ù–æ–≤–∏—á–æ–∫", "callback_data": "exp_beginner"}],
            [{"text": "üìö –ò–∑—É—á–∞—é –æ—Å–Ω–æ–≤—ã", "callback_data": "exp_learning"}],
            [{"text": "üíº –†–∞–±–æ—Ç–∞—é –≤ —Å—Ñ–µ—Ä–µ", "callback_data": "exp_working"}],
            [{"text": "üéì –≠–∫—Å–ø–µ—Ä—Ç", "callback_data": "exp_expert"}]
          ]
        }
      },
      "next_step": "wait_experience_answer"
    },
    {
      "id": "wait_experience_answer",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 300,
        "output_var": "user_experience"
      },
      "next_step": "ask_goals"
    },
    {
      "id": "ask_goals",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "üéØ <b>–í–æ–ø—Ä–æ—Å 2/5:</b> –ö–∞–∫–∞—è —Ç–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –∏–∑—É—á–µ–Ω–∏—è –ò–ò?",
          "buttons": [
            [{"text": "üíº –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç", "callback_data": "goal_career"}],
            [{"text": "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞", "callback_data": "goal_project"}],
            [{"text": "üß† –û–±—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ", "callback_data": "goal_development"}],
            [{"text": "üéì –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ —Ü–µ–ª–∏", "callback_data": "goal_academic"}]
          ]
        }
      },
      "next_step": "wait_goals_answer"
    },
    {
      "id": "wait_goals_answer",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 300,
        "output_var": "user_goals"
      },
      "next_step": "ask_time"
    },
    {
      "id": "ask_time",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "‚è∞ <b>–í–æ–ø—Ä–æ—Å 3/5:</b> –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –Ω–µ–¥–µ–ª—é –≥–æ—Ç–æ–≤ —É–¥–µ–ª—è—Ç—å –æ–±—É—á–µ–Ω–∏—é?",
          "buttons": [
            [{"text": "‚ö° 1-2 —á–∞—Å–∞", "callback_data": "time_low"}],
            [{"text": "üìö 3-5 —á–∞—Å–æ–≤", "callback_data": "time_medium"}],
            [{"text": "üî• 6-10 —á–∞—Å–æ–≤", "callback_data": "time_high"}],
            [{"text": "üí™ –ë–æ–ª–µ–µ 10 —á–∞—Å–æ–≤", "callback_data": "time_intensive"}]
          ]
        }
      },
      "next_step": "wait_time_answer"
    },
    {
      "id": "wait_time_answer",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 300,
        "output_var": "user_time"
      },
      "next_step": "ask_interests"
    },
    {
      "id": "ask_interests",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "üîç <b>–í–æ–ø—Ä–æ—Å 4/5:</b> –ö–∞–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏ –ò–ò —Ç–µ–±—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç?",
          "buttons": [
            [{"text": "ü§ñ –ß–∞—Ç-–±–æ—Ç—ã –∏ NLP", "callback_data": "interest_nlp"}],
            [{"text": "üëÅÔ∏è –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ", "callback_data": "interest_cv"}],
            [{"text": "üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö", "callback_data": "interest_data"}],
            [{"text": "üéÆ –í—Å–µ –ø–æ–Ω–µ–º–Ω–æ–≥—É", "callback_data": "interest_all"}]
          ]
        }
      },
      "next_step": "wait_interests_answer"
    },
    {
      "id": "wait_interests_answer",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 300,
        "output_var": "user_interests"
      },
      "next_step": "ask_format"
    },
    {
      "id": "ask_format",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_buttons",
        "context_updates": {
          "text": "üìñ <b>–í–æ–ø—Ä–æ—Å 5/5:</b> –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å?",
          "buttons": [
            [{"text": "üì∫ –í–∏–¥–µ–æ-—É—Ä–æ–∫–∏", "callback_data": "format_video"}],
            [{"text": "üìö –°—Ç–∞—Ç—å–∏ –∏ –∫–Ω–∏–≥–∏", "callback_data": "format_text"}],
            [{"text": "üíª –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏", "callback_data": "format_practice"}],
            [{"text": "üéØ –°–º–µ—à–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç", "callback_data": "format_mixed"}]
          ]
        }
      },
      "next_step": "wait_format_answer"
    },
    {
      "id": "wait_format_answer",
      "type": "input",
      "params": {
        "input_type": "callback_query",
        "timeout_seconds": 300,
        "output_var": "user_format"
      },
      "next_step": "processing_message"
    },
    {
      "id": "processing_message",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_message",
        "context_updates": {
          "text": "üîÑ <b>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã...</b>\n\n–°–æ–∑–¥–∞—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ:\n‚Ä¢ –¢–≤–æ–µ–≥–æ –æ–ø—ã—Ç–∞: {user_experience}\n‚Ä¢ –¶–µ–ª–µ–π: {user_goals}\n‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏: {user_time}\n‚Ä¢ –ò–Ω—Ç–µ—Ä–µ—Å–æ–≤: {user_interests}\n‚Ä¢ –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π: {user_format}\n\n–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...",
          "parse_mode": "HTML"
        }
      },
      "next_step": "search_materials"
    },
    {
      "id": "search_materials",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_rag_search",
        "context_updates": {
          "query": "–ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –ò–ò {user_experience} {user_goals} {user_interests} {user_format}",
          "collection": "learning_materials",
          "limit": 5,
          "threshold": 0.6,
          "output_var": "relevant_materials"
        }
      },
      "next_step": "generate_plan"
    },
    {
      "id": "generate_plan",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_llm_query",
        "context_updates": {
          "prompt": "–°–æ–∑–¥–∞–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –ò–ò –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n\n–û–ø—ã—Ç: {user_experience}\n–¶–µ–ª–∏: {user_goals}\n–í—Ä–µ–º—è: {user_time}\n–ò–Ω—Ç–µ—Ä–µ—Å—ã: {user_interests}\n–§–æ—Ä–º–∞—Ç: {user_format}\n\n–ù–∞–π–¥–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã: {relevant_materials}\n\n–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ 4 –Ω–µ–¥–µ–ª–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —à–∞–≥–∞–º–∏, —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä–∞–º–∫–∞–º–∏. –§–æ—Ä–º–∞—Ç: HTML —Å —ç–º–æ–¥–∑–∏.",
          "model": "meta-llama/llama-3.2-70b-instruct",
          "temperature": 0.7,
          "max_tokens": 2000,
          "output_var": "learning_plan"
        }
      },
      "next_step": "save_profile"
    },
    {
      "id": "save_profile",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_mongo_save_data",
        "context_updates": {
          "collection": "users",
          "filter": {"user_id": "{user_id}"},
          "document": {
            "user_id": "{user_id}",
            "chat_id": "{chat_id}",
            "onboarding_completed": true,
            "experience_level": "{user_experience}",
            "learning_goals": "{user_goals}",
            "weekly_time": "{user_time}",
            "interests": "{user_interests}",
            "preferred_format": "{user_format}",
            "learning_plan": "{learning_plan}",
            "plan_created_at": "{current_time}",
            "is_new": false
          },
          "upsert": true
        }
      },
      "next_step": "send_plan"
    },
    {
      "id": "send_plan",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_telegram_send_message",
        "context_updates": {
          "text": "üéì <b>–¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤!</b>\n\n{learning_plan}\n\nüí° <i>–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏ –õ–∞–π–∫–ü—Ä–æ–≤–æ–¥–Ω–∏–∫–∞. –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!</i>",
          "parse_mode": "HTML"
        }
      },
      "next_step": "schedule_reminder"
    },
    {
      "id": "schedule_reminder",
      "type": "switch_scenario",
      "params": {
        "target_scenario": "atomic_scheduler_create_task",
        "context_updates": {
          "scenario_id": "weekly_plan_reminder",
          "delay_minutes": 10080,
          "task_context": {
            "reminder_type": "learning_plan",
            "plan_week": 1
          }
        }
      },
      "next_step": "end"
    },
    {
      "id": "end",
      "type": "end"
    }
  ]
} 