# === –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–û–ù–ù–´–ô –°–¶–ï–ù–ê–†–ò–ô AMOCRM ===
# –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å AmoCRM: –ø–æ–∏—Å–∫, —Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

scenario_id: amocrm_demo_full
description: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π AmoCRM –ø–ª–∞–≥–∏–Ω–∞"

# –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
initial_context:
  version: "1.0"
  template_type: "amocrm_demo"
  demo_company_name: "–û–û–û –¢–µ—Å—Ç–æ–≤–∞—è –ö–æ–º–ø–∞–Ω–∏—è"
  demo_contact_name: "–ò–≤–∞–Ω –¢–µ—Å—Ç–æ–≤—ã–π"
  demo_phone: "+79991234567"
  demo_email: "ivan.test@example.com"
  
steps:
  # === –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –°–¢–ê–†–¢ ===
  - id: start
    type: start
    next_step: welcome

  # === –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ===
  - id: welcome
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üöÄ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è AmoCRM –ø–ª–∞–≥–∏–Ω–∞**
        
        –≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å AmoCRM:
        ‚Ä¢ –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫
        ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
        ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
        ‚Ä¢ –†–∞–±–æ—Ç–∞ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏
        
        –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é...
      parse_mode: HTML
    next_step: search_existing_contacts

  # === –ü–û–ò–°–ö –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –ö–û–ù–¢–ê–ö–¢–û–í ===
  - id: search_existing_contacts
    type: amocrm_search
    params:
      entity: "contacts"
      query: "test"
      output_var: "existing_contacts"
    next_step: show_search_results

  # === –ü–û–ö–ê–ó–ê–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê ===
  - id: show_search_results
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üîç **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
        
        –ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: {existing_contacts.data|length}
        
        {% if existing_contacts.data %}
        –ü–µ—Ä–≤—ã–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã:
        {% for contact in existing_contacts.data[:3] %}
        ‚Ä¢ ID: {contact.id}, –ò–º—è: {contact.name}
        {% endfor %}
        {% else %}
        –ö–æ–Ω—Ç–∞–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        {% endif %}
        
        –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞...
      parse_mode: HTML
    next_step: create_new_contact

  # === –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û –ö–û–ù–¢–ê–ö–¢–ê ===
  - id: create_new_contact
    type: amocrm_create_contact
    params:
      name: "{demo_contact_name}"
      phone: "{demo_phone}"
      email: "{demo_email}"
      output_var: "new_contact"
    next_step: show_contact_created

  # === –ü–û–ö–ê–ó–ê–¢–¨ –°–û–ó–î–ê–ù–ù–´–ô –ö–û–ù–¢–ê–ö–¢ ===
  - id: show_contact_created
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        ‚úÖ **–ö–æ–Ω—Ç–∞–∫—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!**
        
        ID –∫–æ–Ω—Ç–∞–∫—Ç–∞: {new_contact.contact_id}
        –ò–º—è: {demo_contact_name}
        –¢–µ–ª–µ—Ñ–æ–Ω: {demo_phone}
        Email: {demo_email}
        
        –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ–º —Å–¥–µ–ª–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞...
      parse_mode: HTML
    next_step: create_new_lead

  # === –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ô –°–î–ï–õ–ö–ò ===
  - id: create_new_lead
    type: amocrm_create_lead
    params:
      name: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–¥–µ–ª–∫–∞"
      price: 100000
      contact_id: "{new_contact.contact_id}"
      output_var: "new_lead"
    next_step: show_lead_created

  # === –ü–û–ö–ê–ó–ê–¢–¨ –°–û–ó–î–ê–ù–ù–£–Æ –°–î–ï–õ–ö–£ ===
  - id: show_lead_created
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üíº **–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**
        
        ID —Å–¥–µ–ª–∫–∏: {new_lead.lead_id}
        –ù–∞–∑–≤–∞–Ω–∏–µ: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–¥–µ–ª–∫–∞
        –°—É–º–º–∞: 100,000 —Ä—É–±.
        –ö–æ–Ω—Ç–∞–∫—Ç ID: {new_contact.contact_id}
        
        –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–º–µ—Ç–∫—É –∫ —Å–¥–µ–ª–∫–µ...
      parse_mode: HTML
    next_step: add_note_to_lead

  # === –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ú–ï–¢–ö–ò –ö –°–î–ï–õ–ö–ï ===
  - id: add_note_to_lead
    type: amocrm_add_note
    params:
      entity_type: "leads"
      entity_id: "{new_lead.lead_id}"
      note_text: "–°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π. –ö–æ–Ω—Ç–∞–∫—Ç: {demo_contact_name} ({demo_phone})"
      note_type: "common"
      output_var: "lead_note"
    next_step: create_company

  # === –°–û–ó–î–ê–ù–ò–ï –ö–û–ú–ü–ê–ù–ò–ò ===
  - id: create_company
    type: amocrm_create_company
    params:
      name: "{demo_company_name}"
      output_var: "new_company"
    next_step: show_company_created

  # === –ü–û–ö–ê–ó–ê–¢–¨ –°–û–ó–î–ê–ù–ù–£–Æ –ö–û–ú–ü–ê–ù–ò–Æ ===
  - id: show_company_created
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üè¢ **–ö–æ–º–ø–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**
        
        ID –∫–æ–º–ø–∞–Ω–∏–∏: {new_company.company_id}
        –ù–∞–∑–≤–∞–Ω–∏–µ: {demo_company_name}
        
        –°–≤—è–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç —Å –∫–æ–º–ø–∞–Ω–∏–µ–π...
      parse_mode: HTML
    next_step: link_contact_to_company

  # === –°–í–Ø–ó–´–í–ê–ù–ò–ï –ö–û–ù–¢–ê–ö–¢–ê –° –ö–û–ú–ü–ê–ù–ò–ï–ô ===
  - id: link_contact_to_company
    type: amocrm_link_contact_to_company
    params:
      contact_id: "{new_contact.contact_id}"
      company_id: "{new_company.company_id}"
      output_var: "link_result"
    next_step: create_task

  # === –°–û–ó–î–ê–ù–ò–ï –ó–ê–î–ê–ß–ò ===
  - id: create_task
    type: amocrm_create_task
    params:
      text: "–°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º {demo_contact_name}"
      complete_till: 1750000000
      entity_type: "leads"
      entity_id: "{new_lead.lead_id}"
      output_var: "new_task"
    next_step: show_final_summary

  # === –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–í–û–î–ö–ê ===
  - id: show_final_summary
    type: channel_action
    params:
      action: send_message
      chat_id: "{chat_id}"
      text: |
        üéâ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**
        
        **–ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ:**
        ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç: {demo_contact_name} (ID: {new_contact.contact_id})
        ‚úÖ –ö–æ–º–ø–∞–Ω–∏—è: {demo_company_name} (ID: {new_company.company_id})
        ‚úÖ –°–¥–µ–ª–∫–∞: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–¥–µ–ª–∫–∞" (ID: {new_lead.lead_id})
        ‚úÖ –ó–∞–º–µ—Ç–∫–∞ –∫ —Å–¥–µ–ª–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞
        ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç —Å–≤—è–∑–∞–Ω —Å –∫–æ–º–ø–∞–Ω–∏–µ–π
        ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–¥–∞—á–∞ (ID: {new_task.task_id})
        
        **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
        ‚Ä¢ –ù–∞–π–¥–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: {existing_contacts.data|length}
        ‚Ä¢ –û–±—â–∞—è —Å—É–º–º–∞ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏: 100,000 —Ä—É–±.
        
        –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ AmoCRM API!
      parse_mode: HTML
    next_step: final_menu

  # === –§–ò–ù–ê–õ–¨–ù–û–ï –ú–ï–ù–Æ ===
  - id: final_menu
    type: channel_action
    params:
      action: send_buttons
      chat_id: "{chat_id}"
      text: "–ß—Ç–æ –¥–∞–ª—å—à–µ?"
      buttons:
        - - text: "üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–º–æ"
            callback_data: "restart"
        - - text: "üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
            callback_data: "show_data"
        - - text: "‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å"
            callback_data: "finish"
    next_step: end

  # === –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ö–û–ù–ï–¶ ===
  - id: end
    type: end

# === –û–°–û–ë–ï–ù–ù–û–°–¢–ò –°–¶–ï–ù–ê–†–ò–Ø ===
# 1. –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ AmoCRM –æ–ø–µ—Ä–∞—Ü–∏–∏
# 2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
# 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
# 4. –°–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–∫–æ–Ω—Ç–∞–∫—Ç -> –∫–æ–º–ø–∞–Ω–∏—è -> —Å–¥–µ–ª–∫–∞ -> –∑–∞–¥–∞—á–∞)
# 5. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ 